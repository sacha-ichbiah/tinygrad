
<!DOCTYPE html>
<html>
<head>
    <title>Free Rigid Body (Dzhanibekov Effect)</title>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; }
        canvas { border: 1px solid #444; }
        .info { margin: 10px; text-align: center; }
    </style>
</head>
<body>
    <h1>Rigid Body Tumbling</h1>
    <p>Yellow axis marks the unstable intermediate axis (Iâ‚‚).</p>
    <p class="info">Using Lie-Poisson mechanics with implicit midpoint integrator.</p>
    <canvas id="simCanvas" width="600" height="600"></canvas>
    <script>
        const history = [[1.0, 0.0, 0.0, 0.0], [0.9987502098083496, 0.0004908075788989663, 0.04997885599732399, 0.00015766713477205485], [0.9950037002563477, 0.0009646609541960061, 0.09983289241790771, 0.0002995824324898422], [0.988770067691803, 0.001421253546141088, 0.1494375467300415, 0.00042650761315599084], [0.980064868927002, 0.0018603389617055655, 0.19866876304149628, 0.0005390699370764196], [0.968909740447998, 0.0022817174904048443, 0.24740347266197205, 0.0006377651588991284], [0.9553325176239014, 0.0026852290611714125, 0.2955198287963867, 0.0007229610346257687], [0.9393675327301025, 0.0030707402620464563, 0.3428976535797119, 0.0007949009304866195], [0.9210542440414429, 0.0034381342120468616, 0.3894183337688446, 0.0008537082467228174], [0.9004386067390442, 0.003787300316616893, 0.4349657893180847, 0.000899391365237534], [0.8775722980499268, 0.004118127748370171, 0.47942593693733215, 0.0009318487136624753], [0.8525122404098511, 0.004430492874234915, 0.5226877331733704, 0.0009508741204626858], [0.8253211379051208, 0.004724252503365278, 0.5646430850028992, 0.0009561632759869099], [0.7960669994354248, 0.004999232478439808, 0.6051871180534363, 0.0009473200188949704], [0.7648230791091919, 0.005255221854895353, 0.6442183256149292, 0.0009238629718311131], [0.7316673398017883, 0.005491961725056171, 0.6816392540931702, 0.0008852327591739595], [0.6966825723648071, 0.005709140095859766, 0.7173563241958618, 0.000830799457617104], [0.6599564552307129, 0.005906379781663418, 0.7512803077697754, 0.0007598716183565557], [0.6215805411338806, 0.006083233747631311, 0.7833263874053955, 0.000671703543048352], [0.581650972366333, 0.006239178590476513, 0.8134143352508545, 0.0005655054119415581], [0.5402674674987793, 0.006373599637299776, 0.8414690494537354, 0.0004404517821967602], [0.4975334405899048, 0.006485794670879841, 0.867420494556427, 0.00029569221078418195], [0.4535558223724365, 0.006574953906238079, 0.8912035822868347, 0.00013036179007031024], [0.4084444046020508, 0.006640166975557804, 0.912759006023407, -5.640811286866665e-05], [0.36231210827827454, 0.006680402904748917, 0.9320328235626221, -0.0002654779818840325], [0.3152742385864258, 0.006694513373076916, 0.9489769339561462, -0.0004976876662112772], [0.2674483358860016, 0.006681220140308142, 0.9635487198829651, -0.0007538434001617134], [0.21895387768745422, 0.006639114115387201, 0.9757120609283447, -0.0010347046190872788], [0.1699121743440628, 0.006566645577549934, 0.9854364395141602, -0.0013409694656729698], [0.12044583261013031, 0.00646212138235569, 0.9926974773406982, -0.0016732584917917848], [0.07067856937646866, 0.006323701702058315, 0.997477114200592, -0.0020321011543273926], [0.020734788849949837, 0.006149389781057835, 0.9997632503509521, -0.002417915966361761], [-0.029260629788041115, 0.005937034264206886, 0.9995502233505249, -0.0028309959452599287], [-0.07918266952037811, 0.00568432779982686, 0.9968386292457581, -0.0032714882399886847], [-0.1289065033197403, 0.005388794932514429, 0.9916350841522217, -0.0037393749225884676], [-0.17830774188041687, 0.005047805141657591, 0.9839527010917664, -0.004234453197568655], [-0.22726282477378845, 0.004658559802919626, 0.9738106727600098, -0.004756314679980278], [-0.2756493389606476, 0.004218099173158407, 0.9612343311309814, -0.00530432490631938], [-0.32334622740745544, 0.0037233030889183283, 0.9462552070617676, -0.005877593066543341], [-0.3702341318130493, 0.0031708935275673866, 0.928910493850708, -0.006474955007433891], [-0.416195809841156, 0.0025574408937245607, 0.9092437624931335, -0.007094947155565023], [-0.46111616492271423, 0.0018793679773807526, 0.8873040676116943, -0.007735776714980602], [-0.5048828125, 0.001132958335801959, 0.8631463646888733, -0.00839530024677515], [-0.5473861694335938, 0.0003143667127005756, 0.8368309140205383, -0.00907098688185215], [-0.588519811630249, -0.0005803702515549958, 0.808423638343811, -0.009759902022778988], [-0.6281808018684387, -0.0015553197590634227, 0.7779955863952637, -0.010458667762577534], [-0.6662697196006775, -0.002614635741338134, 0.7456226944923401, -0.011163434013724327], [-0.7026909589767456, -0.0037625425029546022, 0.7113862037658691, -0.01186984870582819], [-0.7373533248901367, -0.005003311205655336, 0.6753717064857483, -0.012573027983307838], [-0.7701699137687683, -0.006341235246509314, 0.6376692652702332, -0.013267519883811474], [-0.801058292388916, -0.007780602667480707, 0.5983733534812927, -0.01394727360457182], [-0.8299407958984375, -0.009325665421783924, 0.5575823187828064, -0.01460560318082571], [-0.8567450046539307, -0.010980609804391861, 0.515398383140564, -0.01523516420274973], [-0.8814032673835754, -0.012749508954584599, 0.4719272255897522, -0.015827909111976624], [-0.9038536548614502, -0.014636279083788395, 0.4272778332233429, -0.01637505739927292], [-0.9240394830703735, -0.016644643619656563, 0.3815619945526123, -0.01686706766486168], [-0.9419097304344177, -0.018778076395392418, 0.3348945081233978, -0.017293602228164673], [-0.957419216632843, -0.02103973552584648, 0.28739258646965027, -0.01764349825680256], [-0.9705284833908081, -0.023432420566678047, 0.23917564749717712, -0.01790473610162735], [-0.9812039732933044, -0.025958484038710594, 0.19036485254764557, -0.018064413219690323], [-0.9894183278083801, -0.028619786724448204, 0.14108304679393768, -0.018108712509274483], [-0.9951503276824951, -0.031417589634656906, 0.0914543867111206, -0.018022915348410606], [-0.998384952545166, -0.03435249254107475, 0.041604019701480865, -0.017791319638490677], [-0.999113142490387, -0.037424299865961075, -0.008342139422893524, -0.017397282645106316], [-0.9973325729370117, -0.04063200205564499, -0.058257780969142914, -0.01682317815721035], [-0.9930463433265686, -0.04397357627749443, -0.10801639407873154, -0.016050372272729874], [-0.9862649440765381, -0.04744597524404526, -0.15749172866344452, -0.015059289522469044], [-0.9770041108131409, -0.05104491859674454, -0.20655778050422668, -0.013829347677528858], [-0.9652864933013916, -0.054764848202466965, -0.25508955121040344, -0.012339018285274506], [-0.9511404633522034, -0.058598704636096954, -0.3029627501964569, -0.010565819218754768], [-0.9346009492874146, -0.06253787130117416, -0.35005444288253784, -0.008486366830766201], [-0.9157088398933411, -0.06657198816537857, -0.39624321460723877, -0.006076405290514231], [-0.8945109248161316, -0.07068878412246704, -0.44140946865081787, -0.0033108682837337255], [-0.871060311794281, -0.07487397640943527, -0.4854358434677124, -0.00016394398699048907], [-0.845415472984314, -0.0791110023856163, -0.5282069444656372, 0.003390840720385313], [-0.8176414370536804, -0.08338097482919693, -0.5696101188659668, 0.007380522321909666], [-0.7878082394599915, -0.08766238391399384, -0.6095355153083801, 0.01183257345110178], [-0.7559919357299805, -0.09193099290132523, -0.6478762030601501, 0.016774775460362434], [-0.722274124622345, -0.09615962952375412, -0.6845283508300781, 0.02223505638539791], [-0.6867417693138123, -0.10031796246767044, -0.7193917632102966, 0.028241273015737534], [-0.6494874358177185, -0.10437236726284027, -0.7523696422576904, 0.0348210334777832], [-0.610608696937561, -0.10828569531440735, -0.7833691835403442, 0.042001426219940186], [-0.5702084302902222, -0.11201716959476471, -0.8123013973236084, 0.04980875551700592], [-0.528394877910614, -0.1155221238732338, -0.8390818238258362, 0.058268167078495026], [-0.48528122901916504, -0.1187518760561943, -0.8636301159858704, 0.0674033984541893], [-0.4409855902194977, -0.12165360897779465, -0.885870635509491, 0.07723623514175415], [-0.39563125371932983, -0.12417017668485641, -0.9057324528694153, 0.08778620511293411], [-0.3493466079235077, -0.12624011933803558, -0.923149824142456, 0.0990699827671051], [-0.302264928817749, -0.12779748439788818, -0.9380620718002319, 0.11110079288482666], [-0.2545243501663208, -0.12877190113067627, -0.9504140615463257, 0.12388790398836136], [-0.20626825094223022, -0.1290886253118515, -0.9601567983627319, 0.1374359130859375], [-0.15764488279819489, -0.1286686211824417, -0.9672467708587646, 0.1517440229654312], [-0.10880748927593231, -0.12742871046066284, -0.9716475009918213, 0.16680526733398438], [-0.059914398938417435, -0.12528197467327118, -0.9733293652534485, 0.1826055347919464], [-0.011128921061754227, -0.12213799357414246, -0.9722698330879211, 0.19912280142307281], [0.037380658090114594, -0.11790360510349274, -0.9684547185897827, 0.21632617712020874], [0.08544117212295532, -0.11248333752155304, -0.9618781208992004, 0.23417480289936066], [0.1328747719526291, -0.10578043013811111, -0.9525436758995056, 0.25261712074279785], [0.17949919402599335, -0.09769781678915024, -0.9404649138450623, 0.2715895175933838], [0.22512809932231903, -0.08813938498497009, -0.9256666898727417, 0.2910155653953552], [0.26957154273986816, -0.0770113542675972, -0.9081854224205017, 0.31080490350723267], [0.3126368522644043, -0.06422407925128937, -0.8880708813667297, 0.3308528959751129], [0.3541294038295746, -0.049693845212459564, -0.8653867244720459, 0.3510395288467407], [0.39385396242141724, -0.03334512189030647, -0.8402120471000671, 0.37122905254364014], [0.43161603808403015, -0.015112836845219135, -0.8126420378684998, 0.39126989245414734], [0.4672239124774933, 0.005055110901594162, -0.7827895283699036, 0.4109949767589569], [0.5004904270172119, 0.02719520963728428, -0.7507855892181396, 0.430221825838089], [0.5312357544898987, 0.051325686275959015, -0.7167803049087524, 0.44875413179397583], [0.5592904686927795, 0.07744385302066803, -0.680942952632904, 0.466383159160614], [0.5844978094100952, 0.10552366077899933, -0.6434629559516907, 0.48288992047309875], [0.6067177653312683, 0.13551342487335205, -0.604547917842865, 0.49804776906967163], [0.6258299946784973, 0.16733410954475403, -0.5644246339797974, 0.5116257667541504], [0.641737699508667, 0.20087812840938568, -0.5233358144760132, 0.5233930945396423], [0.6543707251548767, 0.2360086888074875, -0.4815388023853302, 0.533122181892395], [0.6636883020401001, 0.27256008982658386, -0.43930211663246155, 0.5405945777893066], [0.6696814894676208, 0.31033870577812195, -0.39690253138542175, 0.5456051230430603], [0.6723751425743103, 0.3491251468658447, -0.3546205759048462, 0.5479668378829956], [0.6718285083770752, 0.38867688179016113, -0.3127361536026001, 0.5475152134895325], [0.6681356430053711, 0.4287321865558624, -0.27152371406555176, 0.544112503528595], [0.661423921585083, 0.46901440620422363, -0.23124727606773376, 0.5376511216163635], [0.6518520712852478, 0.5092364549636841, -0.19215570390224457, 0.5280560851097107], [0.6396076083183289, 0.5491063594818115, -0.15447847545146942, 0.5152870416641235], [0.624902069568634, 0.5883325338363647, -0.11842158436775208, 0.4993380904197693], [0.6079676151275635, 0.6266282796859741, -0.0841645672917366, 0.4802382290363312], [0.5890508890151978, 0.6637170910835266, -0.05185810476541519, 0.45804959535598755], [0.5684086680412292, 0.6993366479873657, -0.02162262238562107, 0.43286529183387756], [0.5463025569915771, 0.7332417368888855, 0.006452167872339487, 0.40480658411979675], [0.5229937434196472, 0.765207827091217, 0.03230690956115723, 0.3740198314189911], [0.49873852729797363, 0.795032262802124, 0.05591144040226936, 0.3406723737716675], [0.4737841486930847, 0.8225358128547668, 0.07726293057203293, 0.30494898557662964], [0.44836586713790894, 0.8475633263587952, 0.09638360142707825, 0.26704809069633484], [0.4227035641670227, 0.8699832558631897, 0.11331789195537567, 0.22717806696891785], [0.39700013399124146, 0.8896872997283936, 0.12812955677509308, 0.1855541169643402], [0.3714400827884674, 0.9065889120101929, 0.1408986747264862, 0.14239493012428284], [0.346188485622406, 0.9206229448318481, 0.15171846747398376, 0.09792043268680573], [0.32139116525650024, 0.9317432045936584, 0.16069245338439941, 0.052349433302879333], [0.2971744239330292, 0.9399210214614868, 0.16793179512023926, 0.0058977496810257435], [0.27364617586135864, 0.9451444149017334, 0.1735527366399765, -0.041223134845495224], [0.25089624524116516, 0.9474155902862549, 0.17767436802387238, -0.08880723267793655], [0.228998064994812, 0.9467498064041138, 0.18041668832302094, -0.13665486872196198], [0.20800937712192535, 0.9431741833686829, 0.18189898133277893, -0.1845731884241104], [0.18797393143177032, 0.9367261528968811, 0.18223848938941956, -0.23237670958042145], [0.168922558426857, 0.9274525046348572, 0.18154916167259216, -0.2798873782157898], [0.15087462961673737, 0.9154081344604492, 0.17994073033332825, -0.32693466544151306], [0.13383933901786804, 0.9006552696228027, 0.17751826345920563, -0.373355507850647], [0.11781706660985947, 0.8832632303237915, 0.17438147962093353, -0.41899460554122925], [0.10280034691095352, 0.8633066415786743, 0.17062430083751678, -0.4637037217617035], [0.08877518773078918, 0.8408660888671875, 0.16633504629135132, -0.5073421001434326], [0.07572188228368759, 0.8160266876220703, 0.16159570217132568, -0.5497758984565735], [0.06361608952283859, 0.7888783812522888, 0.15648259222507477, -0.5908783078193665], [0.052429575473070145, 0.759515106678009, 0.15106593072414398, -0.6305292844772339], [0.0421309769153595, 0.728034496307373, 0.1454101949930191, -0.6686155200004578], [0.032686471939086914, 0.6945379972457886, 0.13957425951957703, -0.7050301432609558], [0.024060415104031563, 0.6591302752494812, 0.13361169397830963, -0.7396730780601501], [0.016215799376368523, 0.6219191551208496, 0.12757077813148499, -0.7724502682685852], [0.009114743210375309, 0.5830149054527283, 0.12149494886398315, -0.8032743334770203], [0.0027188973035663366, 0.5425311326980591, 0.11542297154664993, -0.8320637941360474], [-0.003010228741914034, 0.5005834102630615, 0.1093892976641655, -0.8587440252304077], [-0.008110958151519299, 0.4572896659374237, 0.10342425853013992, -0.8832461833953857], [-0.012621201574802399, 0.4127700924873352, 0.09755437076091766, -0.9055080413818359], [-0.01657823473215103, 0.36714646220207214, 0.09180251508951187, -0.9254734516143799], [-0.02001851797103882, 0.3205421566963196, 0.08618839830160141, -0.9430925250053406], [-0.02297757752239704, 0.27308225631713867, 0.0807286724448204, -0.9583220481872559], [-0.02548982761800289, 0.22489285469055176, 0.07543718069791794, -0.9711244702339172], [-0.027588527649641037, 0.17610104382038116, 0.07032517343759537, -0.9814691543579102], [-0.029305677860975266, 0.12683460116386414, 0.06540156155824661, -0.9893315434455872], [-0.030671969056129456, 0.07722178101539612, 0.06067315489053726, -0.9946933388710022], [-0.03171675652265549, 0.027391133829951286, 0.05614485591650009, -0.9975428581237793], [-0.032468032091856, -0.02252885513007641, 0.051819827407598495, -0.9978742599487305], [-0.03295234218239784, -0.0724099725484848, 0.04769962653517723, -0.9956886172294617], [-0.033194929361343384, -0.12212459743022919, 0.04378446191549301, -0.9909927845001221], [-0.0332195870578289, -0.1715458780527115, 0.04007328301668167, -0.9838000535964966], [-0.03304880112409592, -0.22054807841777802, 0.036563973873853683, -0.9741300940513611], [-0.03270367905497551, -0.26900678873062134, 0.03325344994664192, -0.9620083570480347], [-0.0322040393948555, -0.3167993724346161, 0.030137799680233, -0.9474665522575378], [-0.031568389385938644, -0.3638048768043518, 0.02721240185201168, -0.9305422902107239], [-0.03081403113901615, -0.40990468859672546, 0.02447204478085041, -0.9112792611122131], [-0.029957035556435585, -0.45498257875442505, 0.02191099524497986, -0.8897266387939453], [-0.029012320563197136, -0.49892500042915344, 0.01952310837805271, -0.8659393787384033], [-0.027993695810437202, -0.5416216850280762, 0.01730191521346569, -0.8399779200553894], [-0.02691391296684742, -0.5829652547836304, 0.015240705572068691, -0.8119081854820251], [-0.025784669443964958, -0.6228518486022949, 0.01333256158977747, -0.781801164150238], [-0.024616725742816925, -0.6611814498901367, 0.011570456437766552, -0.7497327923774719], [-0.02341989427804947, -0.6978579163551331, 0.009947292506694794, -0.7157840728759766], [-0.022203119471669197, -0.7327894568443298, 0.008455962873995304, -0.6800406575202942], [-0.02097451128065586, -0.7658885717391968, 0.007089380174875259, -0.6425920128822327], [-0.019741402938961983, -0.7970724105834961, 0.005840539466589689, -0.6035327911376953], [-0.018510380759835243, -0.8262628316879272, 0.004702529404312372, -0.5629608631134033], [-0.01728735864162445, -0.8533871173858643, 0.0036685785744339228, -0.5209781527519226], [-0.01607758179306984, -0.8783771991729736, 0.0027320822700858116, -0.47768986225128174], [-0.01488570962101221, -0.9011706113815308, 0.0018866199534386396, -0.4332047998905182], [-0.013715830631554127, -0.9217104911804199, 0.001125976792536676, -0.3876344859600067], [-0.012571502476930618, -0.9399453997612, 0.0004441609780769795, -0.341092973947525], [-0.011455817148089409, -0.955829918384552, -0.00016458296158816665, -0.2936969995498657], [-0.010371399112045765, -0.9693243503570557, -0.0007057639304548502, -0.24556511640548706], [-0.009320477023720741, -0.9803950190544128, -0.001184635329991579, -0.19681794941425323], [-0.008304890245199203, -0.9890143275260925, -0.001606189412996173, -0.1475774347782135], [-0.00732613867148757, -0.9951608180999756, -0.00197515357285738, -0.09796689450740814], [-0.006385405547916889, -0.9988190531730652, -0.0022959860507398844, -0.0481104776263237], [-0.005483588669449091, -0.9999799728393555, -0.0025728787295520306, 0.0018670690478757024], [-0.004621325992047787, -0.998640775680542, -0.0028097564354538918, 0.05184069648385048]];
        const I = [1.0, 2.0, 3.0];
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 100;

        // Box geometry scaled by inertia (larger I = smaller dimension)
        const vertices = [
            [-1, -0.5, -0.2], [1, -0.5, -0.2], [1, 0.5, -0.2], [-1, 0.5, -0.2],
            [-1, -0.5, 0.2], [1, -0.5, 0.2], [1, 0.5, 0.2], [-1, 0.5, 0.2]
        ];

        let frame = 0;

        function rotateByQuat(v, q) {
            const [w, x, y, z] = q;
            const [vx, vy, vz] = v;
            const x2 = x + x, y2 = y + y, z2 = z + z;
            const xx = x * x2, xy = x * y2, xz = x * z2;
            const yy = y * y2, yz = y * z2, zz = z * z2;
            const wx = w * x2, wy = w * y2, wz = w * z2;
            return [
                (1 - (yy + zz)) * vx + (xy - wz) * vy + (xz + wy) * vz,
                (xy + wz) * vx + (1 - (xx + zz)) * vy + (yz - wx) * vz,
                (xz - wy) * vx + (yz + wx) * vy + (1 - (xx + yy)) * vz
            ];
        }

        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const q = history[frame];
            const projected = vertices.map(v => {
                const rot = rotateByQuat(v, q);
                return [cx + rot[0] * scale, cy + rot[1] * scale];
            });

            // Draw box edges
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            const edges = [
                [0,1], [1,2], [2,3], [3,0],
                [4,5], [5,6], [6,7], [7,4],
                [0,4], [1,5], [2,6], [3,7]
            ];
            ctx.beginPath();
            edges.forEach(e => {
                ctx.moveTo(projected[e[0]][0], projected[e[0]][1]);
                ctx.lineTo(projected[e[1]][0], projected[e[1]][1]);
            });
            ctx.stroke();

            // Draw body axes: Red (stable), Yellow (unstable), Blue (stable)
            const axes = [[1.5, 0, 0], [0, 1.2, 0], [0, 0, 0.8]];
            const colors = ['#f00', '#ff0', '#00f'];
            axes.forEach((axis, i) => {
                const rot = rotateByQuat(axis, q);
                ctx.strokeStyle = colors[i];
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx + rot[0] * scale, cy + rot[1] * scale);
                ctx.stroke();
            });

            frame = (frame + 1) % history.length;
            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
    