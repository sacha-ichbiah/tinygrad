
<!DOCTYPE html>
<html>
<head>
    <title>Free Rigid Body (Dzhanibekov Effect)</title>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; }
        canvas { border: 1px solid #444; }
    </style>
</head>
<body>
    <h1>Rigid Body Tumbling</h1>
    <p>Yellow ends marks the unstable axis.</p>
    <canvas id="simCanvas" width="600" height="600"></canvas>
    <script>
        const history = [[0.9999874830245972, 4.983353937859647e-05, 0.004999939352273941, 1.6500067431479692e-05], [0.9984877705574036, 0.0005389614379964769, 0.05497193709015846, 0.0001725538750179112], [0.9944920539855957, 0.0010111015290021896, 0.10480663180351257, 0.00031293812207877636], [0.9880104660987854, 0.0014659535372629762, 0.15437950193881989, 0.00043840109719894826], [0.9790590405464172, 0.0019032765412703156, 0.2035665661096573, 0.0005495566874742508], [0.9676603674888611, 0.002322874963283539, 0.25224488973617554, 0.0006468877545557916], [0.9538429975509644, 0.0027245928067713976, 0.30029284954071045, 0.0007307492778636515], [0.9376411437988281, 0.0031082970090210438, 0.34759020805358887, 0.0008013724582269788], [0.9190954566001892, 0.0034738730173557997, 0.3940187990665436, 0.0008588689379394054], [0.8982523083686829, 0.0038212104700505733, 0.4394625723361969, 0.0009032360394485295], [0.8751639723777771, 0.004150197375565767, 0.48380786180496216, 0.0009343612473458052], [0.8498879671096802, 0.004460709635168314, 0.5269438028335571, 0.0009520286112092435], [0.8224873542785645, 0.004752599634230137, 0.5687627196311951, 0.0009559241007082164], [0.793030858039856, 0.005025691352784634, 0.6091599464416504, 0.0009456429397687316], [0.7615922093391418, 0.005279768258333206, 0.6480344533920288, 0.0009206955437548459], [0.7282496690750122, 0.005514566320925951, 0.6852890849113464, 0.000880515028256923], [0.6930867433547974, 0.0057297698222100735, 0.7208309769630432, 0.0008244650671258569], [0.6561914682388306, 0.005924992263317108, 0.7545709013938904, 0.0007518483325839043], [0.6176558136940002, 0.006099780090153217, 0.7864246368408203, 0.0006619145278818905], [0.577576220035553, 0.006253601051867008, 0.8163126111030579, 0.0005538694676943123], [0.5360528826713562, 0.00638583255931735, 0.8441601395606995, 0.0004268849443178624], [0.49318960309028625, 0.006495761685073376, 0.8698976039886475, 0.00028010865207761526], [0.4490935206413269, 0.006582568399608135, 0.8934605121612549, 0.0001126746938098222], [0.40387484431266785, 0.00664533069357276, 0.9147900938987732, -7.62852214393206e-05], [0.35764679312705994, 0.006683007813990116, 0.9338330030441284, -0.0002876299258787185], [0.31052473187446594, 0.006694437004625797, 0.950541615486145, -0.0005221966421231627], [0.2626265287399292, 0.006678327918052673, 0.9648742079734802, -0.0007807874935679138], [0.2140718698501587, 0.006633257493376732, 0.9767948985099792, -0.001064156647771597], [0.1649821251630783, 0.0065576606430113316, 0.9862737655639648, -0.0013729945058003068], [0.11548010259866714, 0.0064498321153223515, 0.9932873845100403, -0.001707914168946445], [0.0656895712018013, 0.006307914387434721, 0.9978179931640625, -0.002069433918222785], [0.01573500595986843, 0.006129897199571133, 0.9998543858528137, -0.002457961207255721], [-0.03425869718194008, 0.005913613364100456, 0.9993913769721985, -0.002873774850741029], [-0.084166519343853, 0.0056567382998764515, 0.9964301586151123, -0.00331700686365366], [-0.1338636726140976, 0.005356782581657171, 0.9909781217575073, -0.0037876213900744915], [-0.1832258403301239, 0.0050110965967178345, 0.9830487966537476, -0.004285397939383984], [-0.2321295440196991, 0.004616866819560528, 0.972662091255188, -0.004809902980923653], [-0.2804524898529053, 0.004171117674559355, 0.9598438143730164, -0.0053604780696332455], [-0.32807376980781555, 0.003670712234452367, 0.9446263313293457, -0.005936207715421915], [-0.3748743236064911, 0.003112357808277011, 0.9270474314689636, -0.006535899359732866], [-0.42073696851730347, 0.0024926092009991407, 0.9071509838104248, -0.007158053573220968], [-0.46554693579673767, 0.001807875232771039, 0.884986937046051, -0.007800848688930273], [-0.5091921091079712, 0.0010544268880039454, 0.8606106042861938, -0.008462103083729744], [-0.5515632629394531, 0.00022840569727122784, 0.8340829014778137, -0.009139247238636017], [-0.5925542116165161, -0.0006741623510606587, 0.80547034740448, -0.009829302318394184], [-0.6320623159408569, -0.001657353714108467, 0.774844229221344, -0.010528841987252235], [-0.669988751411438, -0.002725331112742424, 0.7422813773155212, -0.011233972385525703], [-0.7062381505966187, -0.00388232315890491, 0.7078631520271301, -0.01194028276950121], [-0.740719735622406, -0.005132604856044054, 0.6716756820678711, -0.01264284085482359], [-0.7733470797538757, -0.0064804707653820515, 0.6338095664978027, -0.013336130417883396], [-0.8040381669998169, -0.007930205203592777, 0.5943596363067627, -0.014014042913913727], [-0.8327159881591797, -0.009486059658229351, 0.5534247756004333, -0.014669833704829216], [-0.8593085408210754, -0.011152200400829315, 0.5111072063446045, -0.015296075493097305], [-0.8837487101554871, -0.01293269731104374, 0.4675132632255554, -0.01588466204702854], [-0.9059751033782959, -0.01483144797384739, 0.42275211215019226, -0.016426732763648033], [-0.9259315729141235, -0.01685214787721634, 0.3769358992576599, -0.01691266894340515], [-0.94356769323349, -0.018998246639966965, 0.3301796317100525, -0.0173320509493351], [-0.9588388800621033, -0.021272871643304825, 0.28260087966918945, -0.017673630267381668], [-0.9717060327529907, -0.023678772151470184, 0.2343190312385559, -0.017925303429365158], [-0.9821365475654602, -0.026218263432383537, 0.18545562028884888, -0.01807408221065998], [-0.9901036024093628, -0.02889314480125904, 0.13613355159759521, -0.01810605265200138], [-0.9955864548683167, -0.0317046083509922, 0.08647708594799042, -0.018006399273872375], [-0.9985706806182861, -0.0346531942486763, 0.03661146014928818, -0.017759328708052635], [-0.9990479946136475, -0.0377386212348938, -0.01333733182400465, -0.017348095774650574], [-0.9970165491104126, -0.040959786623716354, -0.06324296444654465, -0.01675497740507126], [-0.9924803972244263, -0.04431456699967384, -0.11297894269227982, -0.01596125215291977], [-0.9854500889778137, -0.047799792140722275, -0.16241897642612457, -0.014947236515581608], [-0.9759425520896912, -0.05141107365489006, -0.21143721044063568, -0.013692259788513184], [-0.9639806747436523, -0.05514268949627876, -0.25990867614746094, -0.012174690142273903], [-0.9495936632156372, -0.05898744985461235, -0.3077092468738556, -0.010371958836913109], [-0.9328169226646423, -0.06293655931949615, -0.35471606254577637, -0.008260589092969894], [-0.9136918783187866, -0.06697947531938553, -0.4008079171180725, -0.005816244520246983], [-0.8922663927078247, -0.07110375165939331, -0.4458654820919037, -0.0030137812718749046], [-0.8685935139656067, -0.0752948522567749, -0.48977139592170715, 0.00017268322699237615], [-0.842732846736908, -0.07953600585460663, -0.5324108004570007, 0.0037696820218116045], [-0.814749538898468, -0.0838080644607544, -0.5736710429191589, 0.007804299704730511], [-0.7847145795822144, -0.08808926492929459, -0.6134428381919861, 0.012304049916565418], [-0.7527042627334595, -0.09235507249832153, -0.6516192555427551, 0.01729673333466053], [-0.7188010215759277, -0.09657803922891617, -0.6880970597267151, 0.022810274735093117], [-0.6830921769142151, -0.10072747617959976, -0.7227761745452881, 0.028872521594166756], [-0.6456709504127502, -0.10476943105459213, -0.7555603981018066, 0.03551104664802551], [-0.606635332107544, -0.10866641253232956, -0.7863571047782898, 0.042752861976623535], [-0.566088855266571, -0.11237726360559464, -0.8150779008865356, 0.05062417685985565], [-0.5241401195526123, -0.11585690826177597, -0.8416386246681213, 0.05915001034736633], [-0.48090288043022156, -0.11905627697706223, -0.8659595251083374, 0.06835392117500305], [-0.43649569153785706, -0.1219220757484436, -0.887965202331543, 0.0782575011253357], [-0.3910425901412964, -0.12439680844545364, -0.907585620880127, 0.08888000249862671], [-0.34467214345932007, -0.12641851603984833, -0.9247550368309021, 0.10023777186870575], [-0.29751822352409363, -0.12792079150676727, -0.9394136667251587, 0.1123436912894249], [-0.24971958994865417, -0.1288328915834427, -0.9515069723129272, 0.1252065896987915], [-0.20141999423503876, -0.12907952070236206, -0.9609862565994263, 0.13883055746555328], [-0.15276822447776794, -0.12858134508132935, -0.9678089618682861, 0.15321418642997742], [-0.10391803085803986, -0.12725470960140228, -0.9719390869140625, 0.16834984719753265], [-0.05502824857831001, -0.1250123679637909, -0.9733477830886841, 0.18422266840934753], [-0.0062626744620501995, -0.12176363170146942, -0.9720132350921631, 0.20080985128879547], [0.04220990464091301, -0.11741504073143005, -0.9679222106933594, 0.21807953715324402], [0.09021587669849396, -0.11187095940113068, -0.9610697031021118, 0.23598988354206085], [0.1375769078731537, -0.10503454506397247, -0.951460063457489, 0.2544880211353302], [0.18411029875278473, -0.0968087762594223, -0.9391081929206848, 0.2735092043876648], [0.22962933778762817, -0.08709767460823059, -0.924039900302887, 0.29297566413879395], [0.2739437520503998, -0.07580781728029251, -0.9062929749488831, 0.31279557943344116], [0.3168605864048004, -0.06285005807876587, -0.8859184384346008, 0.33286285400390625], [0.35818520188331604, -0.04814142733812332, -0.8629815578460693, 0.3530559539794922], [0.39772239327430725, -0.03160729631781578, -0.8375629782676697, 0.3732375502586365], [0.4352777898311615, -0.013183784671127796, -0.8097594380378723, 0.3932543694972992], [0.4706600606441498, 0.007179773412644863, -0.7796858549118042, 0.4129379093647003], [0.5036826133728027, 0.029518170282244682, -0.7474746704101562, 0.4321041703224182], [0.534166693687439, 0.05384765565395355, -0.7132784128189087, 0.4505557119846344], [0.5619437098503113, 0.08016331493854523, -0.6772680282592773, 0.4680824279785156], [0.5868585109710693, 0.10843661427497864, -0.6396348476409912, 0.4844645857810974], [0.6087729930877686, 0.13861320912837982, -0.6005886197090149, 0.4994748532772064], [0.6275690793991089, 0.17061133682727814, -0.5603577494621277, 0.5128822922706604], [0.6431523561477661, 0.20432035624980927, -0.5191861987113953, 0.5244557857513428], [0.6554555296897888, 0.23960071802139282, -0.4773329198360443, 0.533968985080719], [0.6644407510757446, 0.27628394961357117, -0.43506747484207153, 0.5412042737007141], [0.6701024770736694, 0.31417348980903625, -0.3926669955253601, 0.5459582209587097], [0.6724689602851868, 0.35304757952690125, -0.3504122793674469, 0.548045814037323], [0.6716030836105347, 0.3926616907119751, -0.3085828423500061, 0.5473050475120544], [0.6676022410392761, 0.4327522814273834, -0.2674522399902344, 0.5436009764671326], [0.660597026348114, 0.47304147481918335, -0.22728331387043, 0.5368292331695557], [0.6507493257522583, 0.5132414698600769, -0.18832311034202576, 0.5269182920455933], [0.6382489204406738, 0.5530602335929871, -0.1507989764213562, 0.5138311982154846], [0.6233097314834595, 0.5922062397003174, -0.11491433531045914, 0.4975655674934387], [0.6061657667160034, 0.6303935647010803, -0.08084601908922195, 0.4781538248062134], [0.5870647430419922, 0.6673470735549927, -0.04874162748456001, 0.4556610882282257], [0.5662643313407898, 0.7028060555458069, -0.018718592822551727, 0.43018367886543274], [0.5440261363983154, 0.736527144908905, 0.009136451408267021, 0.4018455147743225], [0.5206111669540405, 0.7682878971099854, 0.03476714715361595, 0.3707951307296753], [0.49627485871315, 0.7978880405426025, 0.05814614146947861, 0.3372017443180084], [0.47126367688179016, 0.825150728225708, 0.07927324622869492, 0.3012517988681793], [0.4458111524581909, 0.8499231934547424, 0.09817298501729965, 0.2631446123123169], [0.4201357066631317, 0.8720762133598328, 0.11489192396402359, 0.22308963537216187], [0.3944384455680847, 0.8915035724639893, 0.12949557602405548, 0.18130244314670563], [0.3689018487930298, 0.9081212878227234, 0.1420654058456421, 0.13800197839736938], [0.34368929266929626, 0.9218658208847046, 0.15269586443901062, 0.09340819716453552], [0.31894436478614807, 0.93269282579422, 0.16149134933948517, 0.047739606350660324], [0.29479169845581055, 0.9405757784843445, 0.1685636192560196, 0.0012116977013647556], [0.27133721113204956, 0.9455037117004395, 0.17402926087379456, -0.0459645576775074], [0.24866923689842224, 0.947480320930481, 0.178007572889328, -0.09358377754688263], [0.22685940563678741, 0.9465222954750061, 0.18061859905719757, -0.14144693315029144], [0.205964133143425, 0.9426577687263489, 0.18198144435882568, -0.18936197459697723], [0.18602566421031952, 0.9359250664710999, 0.18221300840377808, -0.23714405298233032], [0.16707371175289154, 0.9263717532157898, 0.18142691254615784, -0.2846158444881439], [0.14912647008895874, 0.9140535593032837, 0.17973244190216064, -0.33160755038261414], [0.13219235837459564, 0.8990337252616882, 0.17723418772220612, -0.3779571056365967], [0.11627080291509628, 0.8813817501068115, 0.17403121292591095, -0.4235096573829651], [0.10135377943515778, 0.8611732125282288, 0.17021703720092773, -0.46811798214912415], [0.08742655813694, 0.8384888172149658, 0.16587917506694794, -0.5116416811943054], [0.07446896284818649, 0.813414454460144, 0.1610991656780243, -0.5539479851722717], [0.062456224113702774, 0.7860403656959534, 0.15595267713069916, -0.5949105620384216], [0.05135976895689964, 0.7564609050750732, 0.1505093276500702, -0.63441002368927], [0.04114794358611107, 0.7247740626335144, 0.14483307301998138, -0.672333836555481], [0.03178673982620239, 0.6910817623138428, 0.13898219168186188, -0.7085757255554199], [0.02324034459888935, 0.6554888486862183, 0.13300977647304535, -0.743036150932312], [0.015471640042960644, 0.6181033849716187, 0.1269635558128357, -0.775621771812439], [0.008442690595984459, 0.5790361762046814, 0.12088649719953537, -0.806245744228363], [0.0021151117980480194, 0.5384008884429932, 0.11481696367263794, -0.8348276615142822], [-0.003549585584551096, 0.4963132441043854, 0.10878891497850418, -0.8612930178642273], [-0.00858969148248434, 0.4528915584087372, 0.10283234715461731, -0.8855738639831543], [-0.013043062761425972, 0.40825608372688293, 0.09697338193655014, -0.9076085090637207], [-0.01694689877331257, 0.3625287711620331, 0.09123454988002777, -0.9273413419723511], [-0.020337585359811783, 0.31583335995674133, 0.08563531190156937, -0.9447234869003296], [-0.0232505202293396, 0.2682948112487793, 0.08019192516803741, -0.9597117900848389], [-0.025720028206706047, 0.2200394868850708, 0.07491803169250488, -0.9722697734832764], [-0.027779236435890198, 0.17119449377059937, 0.06982459872961044, -0.982367217540741], [-0.029460014775395393, 0.12188766151666641, 0.06492035835981369, -0.9899802803993225], [-0.030792925506830215, 0.07224730402231216, 0.0602119117975235, -0.9950913190841675], [-0.03180718049407005, 0.022401969879865646, 0.05570397526025772, -0.9976891279220581], [-0.03253063187003136, -0.027519872412085533, 0.05139954015612602, -0.997768759727478], [-0.032989710569381714, -0.07739005237817764, 0.04730001837015152, -0.9953317642211914], [-0.033209506422281265, -0.1270810067653656, 0.04340547323226929, -0.9903855919837952], [-0.033213675022125244, -0.17646601796150208, 0.039714787155389786, -0.9829443097114563], [-0.03302456811070442, -0.22541941702365875, 0.03622569143772125, -0.9730278253555298], [-0.032663166522979736, -0.2738170325756073, 0.03293503075838089, -0.9606626033782959], [-0.03214914724230766, -0.3215363025665283, 0.029838809743523598, -0.9458808302879333], [-0.03150090202689171, -0.36845654249191284, 0.02693234756588936, -0.9287207722663879], [-0.030735597014427185, -0.4144592881202698, 0.0242103673517704, -0.9092264175415039], [-0.029869215562939644, -0.4594287574291229, 0.021667107939720154, -0.8874478936195374], [-0.028916548937559128, -0.5032515525817871, 0.019296379759907722, -0.8634404540061951], [-0.027891293168067932, -0.5458177328109741, 0.017091693356633186, -0.8372652530670166], [-0.026806090027093887, -0.587020218372345, 0.015046298503875732, -0.8089885115623474], [-0.025672556832432747, -0.6267554759979248, 0.01315326988697052, -0.7786818742752075], [-0.024501346051692963, -0.6649240851402283, 0.011405574157834053, -0.7464218139648438], [-0.023302191868424416, -0.7014301419258118, 0.009796107187867165, -0.7122899293899536], [-0.022083941847085953, -0.7361822724342346, 0.008317750878632069, -0.6763717532157898], [-0.020854635164141655, -0.7690935134887695, 0.006963440682739019, -0.6387579441070557], [-0.019621534273028374, -0.8000814914703369, 0.005726165603846312, -0.599543035030365], [-0.01839115470647812, -0.829068660736084, 0.004599032923579216, -0.5588254928588867], [-0.01716933213174343, -0.8559823632240295, 0.003575283335521817, -0.5167075395584106], [-0.015961263328790665, -0.880755603313446, 0.0026483277324587107, -0.47329476475715637], [-0.014771542511880398, -0.9033262133598328, 0.001811764552257955, -0.42869624495506287], [-0.01360420323908329, -0.9236378073692322, 0.0010593980550765991, -0.38302358984947205], [-0.012462764978408813, -0.94163978099823, 0.0003852579975500703, -0.3363913595676422], [-0.01135026291012764, -0.957287073135376, -0.0002163888275390491, -0.2889164388179779], [-0.010269287042319775, -0.9705406427383423, -0.0007510280120186508, -0.24071766436100006], [-0.009222022257745266, -0.9813673496246338, -0.0012238892959430814, -0.1919156312942505], [-0.008210275322198868, -0.989740252494812, -0.0016399403102695942, -0.14263257384300232], [-0.007235516328364611, -0.9956386089324951, -0.0020038834773004055, -0.092991903424263], [-0.006298895925283432, -0.9990475177764893, -0.0023201543372124434, -0.04311779886484146], [-0.005401284899562597, -0.9999585151672363, -0.0025929196272045374, 0.006864949595183134]];
        const I = [1.0, 2.0, 3.0];
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 100; 
        
        // Define a Box Geometry
        const vertices = [
            [-1, -0.5, -0.2], [1, -0.5, -0.2], [1, 0.5, -0.2], [-1, 0.5, -0.2], // Back face
            [-1, -0.5, 0.2], [1, -0.5, 0.2], [1, 0.5, 0.2], [-1, 0.5, 0.2]   // Front face
        ];
        
        // Axis coloring: X=Red, Y=Green, Z=Blue
        // I1 < I2 < I3
        // We set L near I2 (Y-axis). Y-axis is the intermediate axis (Unstable).
        // The box dimensions roughly correspond to I. (Small dim -> Large I, Large dim -> Small I)
        // I ~ m r^2.
        
        let frame = 0;
        
        function rotateByQuat(v, q) {
            // Rotate vector v by quaternion q
            // v' = q v q*
            const [w, x, y, z] = q;
            const [vx, vy, vz] = v;
            
            // This is efficient formula ... or just convert Q to Matrix
            const x2 = x + x, y2 = y + y, z2 = z + z;
            const xx = x * x2, xy = x * y2, xz = x * z2;
            const yy = y * y2, yz = y * z2, zz = z * z2;
            const wx = w * x2, wy = w * y2, wz = w * z2;
            
            return [
                (1 - (yy + zz)) * vx + (xy - wz) * vy + (xz + wy) * vz,
                (xy + wz) * vx + (1 - (xx + zz)) * vy + (yz - wx) * vz,
                (xz - wy) * vx + (yz + wx) * vy + (1 - (xx + yy)) * vz
            ];
        }
        
        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0,0, canvas.width, canvas.height);
            
            const q = history[frame];
            
            // Project and Draw Lines
            ctx.beginPath();
            const projected = vertices.map(v => {
                 const rot = rotateByQuat(v, q);
                 // Weak perspective
                 const z = rot[2] + 4; 
                 const fov = 300;
                 return [cx + rot[0] * scale, cy + rot[1] * scale];
            });
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            
            // Connections
            const edges = [
                [0,1], [1,2], [2,3], [3,0], // Back
                [4,5], [5,6], [6,7], [7,4], // Front
                [0,4], [1,5], [2,6], [3,7]  // Sides
            ];
            
            edges.forEach(e => {
                ctx.moveTo(projected[e[0]][0], projected[e[0]][1]);
                ctx.lineTo(projected[e[1]][0], projected[e[1]][1]);
            });
            ctx.stroke();
            
            // Draw Axes attached to body
            const axes = [[1.5,0,0], [0,1.2,0], [0,0,0.8]];
            const colors = ['#f00', '#ff0', '#00f']; // Red, Yellow (Unstable), Blue
            
            axes.forEach((axis, i) => {
                const rot = rotateByQuat(axis, q);
                ctx.strokeStyle = colors[i];
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx + rot[0]*scale, cy + rot[1]*scale);
                ctx.stroke();
            });
            
            
            frame = (frame + 1) % history.length;
            requestAnimationFrame(draw);
        }
        
        draw();
    </script>
</body>
</html>
    