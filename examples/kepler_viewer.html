
<!DOCTYPE html>
<html>
<head>
    <title>Kepler Problem - TinyPhysics</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #eee;
            margin: 0;
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            font-weight: 300;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .main-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1400px;
            margin: 0 auto;
        }
        .orbit-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            background: #4af;
            border: none;
            color: #000;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        button:hover { background: #5bf; transform: scale(1.05); }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
        }
        input[type="range"] {
            width: 100px;
            accent-color: #4af;
        }
        .stats-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 10px;
            padding: 20px;
            min-width: 320px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .stat-group {
            margin-bottom: 20px;
        }
        .stat-group h3 {
            color: #4af;
            margin: 0 0 12px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-label { color: #888; }
        .stat-value { color: #fff; font-family: monospace; }
        .stat-value.good { color: #4f4; }
        .stat-value.warn { color: #fa4; }
        .kepler-law {
            background: rgba(74, 170, 255, 0.1);
            border-left: 3px solid #4af;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        .kepler-law .title {
            color: #4af;
            font-weight: bold;
            font-size: 12px;
        }
        .kepler-law .desc {
            color: #aaa;
            font-size: 12px;
            margin-top: 4px;
        }
        .formula {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 4px;
            color: #4f4;
            display: inline-block;
            margin: 5px 0;
        }
        .chart-container {
            margin-top: 15px;
        }
        .chart-container h4 {
            color: #888;
            font-size: 12px;
            margin: 0 0 8px 0;
        }
        .mini-chart {
            background: #000;
            border-radius: 5px;
            height: 60px;
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Kepler Problem</h1>
    <div class="subtitle">Two-body gravitational orbit simulated from Hamiltonian mechanics</div>

    <div class="main-container">
        <div class="orbit-section">
            <canvas id="orbitCanvas" width="550" height="550"></canvas>
            <div class="controls">
                <button id="playBtn">Pause</button>
                <button id="resetBtn">Reset</button>
                <div class="speed-control">
                    <span>Speed:</span>
                    <input type="range" id="speedSlider" min="1" max="20" value="5">
                    <span id="speedLabel">5x</span>
                </div>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-group">
                <h3>Current State</h3>
                <div class="stat-row">
                    <span class="stat-label">Position (x, y)</span>
                    <span class="stat-value" id="posValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Distance from Sun</span>
                    <span class="stat-value" id="distValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Speed</span>
                    <span class="stat-value" id="speedValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Orbit Progress</span>
                    <span class="stat-value" id="orbitValue">-</span>
                </div>
            </div>

            <div class="stat-group">
                <h3>Conservation Laws</h3>
                <div class="stat-row">
                    <span class="stat-label">Total Energy</span>
                    <span class="stat-value good" id="energyValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Energy Drift</span>
                    <span class="stat-value good" id="driftValue">-</span>
                </div>
                <div class="chart-container">
                    <h4>Energy over time</h4>
                    <canvas id="energyChart" class="mini-chart" width="280" height="60"></canvas>
                </div>
            </div>

            <div class="stat-group">
                <h3>Orbital Parameters</h3>
                <div class="stat-row">
                    <span class="stat-label">Semi-major axis (a)</span>
                    <span class="stat-value">1.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Eccentricity (e)</span>
                    <span class="stat-value">0.60</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Perihelion</span>
                    <span class="stat-value">0.40</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Aphelion</span>
                    <span class="stat-value">1.60</span>
                </div>
            </div>

            <div class="kepler-law">
                <div class="title">How it works</div>
                <div class="desc">Only the Hamiltonian is defined:</div>
                <div class="formula">H = pÂ²/2m - GMm/r</div>
                <div class="desc">Equations of motion derived via autograd. Symplectic integrator preserves energy.</div>
            </div>
        </div>
    </div>

    <script>
        const history = [[1.600000023841858, 0.0], [1.5980465412139893, 0.049979645758867264], [1.5921822786331177, 0.09983688592910767], [1.5823959112167358, 0.14944802224636078], [1.5686678886413574, 0.19868668913841248], [1.5509713888168335, 0.2474222332239151], [1.5292710065841675, 0.2955184578895569], [1.5035226345062256, 0.34283193945884705], [1.473673701286316, 0.3892095983028412], [1.4396625757217407, 0.4344870150089264], [1.4014166593551636, 0.4784853160381317], [1.3588542938232422, 0.5210084915161133], [1.311882495880127, 0.5618390440940857], [1.260396122932434, 0.6007339358329773], [1.2042783498764038, 0.6374186873435974], [1.1433987617492676, 0.671579897403717], [1.0776145458221436, 0.7028560638427734], [1.006769061088562, 0.7308251857757568], [0.9306939840316772, 0.7549907565116882], [0.8492112159729004, 0.7747597098350525], [0.7621380686759949, 0.7894148826599121], [0.6692982912063599, 0.7980773448944092], [0.5705403089523315, 0.7996534109115601], [0.4657732844352722, 0.7927612066268921], [0.35503438115119934, 0.7756261229515076], [0.23861455917358398, 0.7459339499473572], [0.11730413138866425, 0.7006311416625977], [-0.0071272943168878555, 0.6356843113899231], [-0.13098815083503723, 0.5459128618240356], [-0.24692533910274506, 0.42537033557891846], [-0.34145456552505493, 0.2697131633758545], [-0.39462780952453613, 0.08281661570072174], [-0.38947033882141113, -0.11579135060310364], [-0.32786068320274353, -0.2983423173427582], [-0.22847048938274384, -0.4480264186859131], [-0.11045549064874649, -0.5629937648773193], [0.013887286186218262, -0.6481834650039673], [0.13798359036445618, -0.7094969153404236], [0.2585606276988983, -0.7519229054450989], [0.3740629255771637, -0.7793133854866028], [0.48380938172340393, -0.7945815920829773], [0.5875642895698547, -0.7999382019042969], [0.6853191256523132, -0.7970830798149109], [0.7771779298782349, -0.7873436808586121], [0.8632987141609192, -0.7717723846435547], [0.9438599348068237, -0.7512180209159851], [1.0190439224243164, -0.7263742685317993], [1.0890272855758667, -0.697816789150238], [1.1539766788482666, -0.6660282611846924], [1.2140461206436157, -0.6314192414283752], [1.2693766355514526, -0.5943423509597778], [1.3200962543487549, -0.5551037192344666], [1.3663201332092285, -0.5139725208282471], [1.4081506729125977, -0.4711870551109314], [1.4456793069839478, -0.4269607961177826], [1.4789862632751465, -0.3814866542816162], [1.5081422328948975, -0.33494070172309875], [1.533206820487976, -0.2874854803085327], [1.554231882095337, -0.2392721325159073], [1.5712591409683228, -0.19044287502765656], [1.5843234062194824, -0.1411328911781311], [1.593449354171753, -0.09147186577320099], [1.5986557006835938, -0.04158567637205124], [1.5999529361724854, 0.008402296341955662], [1.5973432064056396, 0.05836974084377289], [1.5908212661743164, 0.10819412022829056], [1.5803744792938232, 0.15775133669376373], [1.565982460975647, 0.20691446959972382], [1.547616720199585, 0.25555211305618286], [1.5252398252487183, 0.3035270571708679], [1.4988071918487549, 0.35069411993026733], [1.468263864517212, 0.39689868688583374], [1.433546781539917, 0.44197386503219604], [1.3945825099945068, 0.4857384264469147], [1.351286768913269, 0.5279929041862488], [1.3035647869110107, 0.5685158371925354], [1.2513096332550049, 0.6070596575737], [1.1944023370742798, 0.6433436274528503], [1.1327102184295654, 0.6770468354225159], [1.0660878419876099, 0.7077987194061279], [0.9943771362304688, 0.7351662516593933], [0.9174074530601501, 0.7586381435394287], [0.8349996209144592, 0.7776027321815491], [0.7469711303710938, 0.791318416595459], [0.6531480550765991, 0.7988743782043457], [0.5533860325813293, 0.7991349101066589], [0.4476099908351898, 0.7906602621078491], [0.3358882963657379, 0.7715972065925598], [0.2185743898153305, 0.7395224571228027], [0.09658008813858032, 0.6912357211112976], [-0.028085554018616676, 0.6225170493125916], [-0.15126456320285797, 0.5280020236968994], [-0.2647525370121002, 0.40175890922546387], [-0.35384950041770935, 0.2402273714542389], [-0.39807844161987305, 0.04956039413809776], [-0.38268816471099854, -0.14820770919322968], [-0.31323376297950745, -0.3259443938732147], [-0.20954665541648865, -0.46964016556739807], [-0.08979926258325577, -0.5791963338851929], [0.034845590591430664, -0.6599838137626648], [0.15851911902427673, -0.7178119421005249], [0.2783224880695343, -0.7574747800827026], [0.39289113879203796, -0.7826494574546814], [0.5016409754753113, -0.7961158752441406], [0.604386031627655, -0.7999874353408813], [0.7011424899101257, -0.795892596244812], [0.792026937007904, -0.785106897354126], [0.8772023320198059, -0.7686446309089661], [0.9568485617637634, -0.7473253607749939], [1.031147837638855, -0.7218208909034729], [1.1002750396728516, -0.6926893591880798], [1.1643948554992676, -0.660400390625], [1.2236597537994385, -0.6253538727760315], [1.278207778930664, -0.5878937244415283], [1.3281652927398682, -0.5483195185661316], [1.3736448287963867, -0.5068947076797485], [1.4147471189498901, -0.4638531804084778], [1.4515621662139893, -0.41940438747406006], [1.4841678142547607, -0.3737385869026184], [1.512632966041565, -0.3270290493965149], [1.537016749382019, -0.279436320066452], [1.5573680400848389, -0.23111000657081604], [1.5737278461456299, -0.18219085037708282], [1.5861297845840454, -0.13281312584877014], [1.5945971012115479, -0.08310570567846298], [1.5991472005844116, -0.03319397568702698], [1.5997886657714844, 0.016798948869109154], [1.5965226888656616, 0.06675080955028534], [1.5893431901931763, 0.11653890460729599], [1.5782358646392822, 0.16603879630565643], [1.5631792545318604, 0.21512286365032196], [1.5441428422927856, 0.2636588215827942], [1.5210884809494019, 0.3115082085132599], [1.4939701557159424, 0.35852450132369995], [1.462731122970581, 0.40455126762390137], [1.427306890487671, 0.4494193494319916], [1.3876219987869263, 0.4929446578025818], [1.3435906171798706, 0.534924328327179], [1.2951164245605469, 0.5751331448554993], [1.2420895099639893, 0.6133182048797607], [1.1843888759613037, 0.6491924524307251], [1.121880054473877, 0.6824274659156799], [1.0544155836105347, 0.7126433849334717], [0.9818350672721863, 0.7393950819969177], [0.9039657115936279, 0.7621561884880066], [0.8206276893615723, 0.7802954316139221], [0.7316387891769409, 0.793046236038208], [0.6368282437324524, 0.7994644641876221], [0.5360598564147949, 0.7983694076538086], [0.4292760491371155, 0.7882606983184814], [0.31658098101615906, 0.7672016620635986], [0.19839726388454437, 0.7326551079750061], [0.07577323913574219, 0.6812660098075867], [-0.04901391640305519, 0.6086232662200928], [-0.17128658294677734, 0.5091911554336548], [-0.2819128930568695, 0.37712907791137695], [-0.36497339606285095, 0.20987361669540405], [-0.3997953534126282, 0.016082843765616417], [-0.37434688210487366, -0.18002738058567047], [-0.2976490259170532, -0.35255900025367737], [-0.1901845484972, -0.4902857542037964], [-0.06901262700557709, -0.5945910215377808], [0.05577472969889641, -0.6711409687995911], [0.17894691228866577, -0.7256177663803101], [0.2979397177696228, -0.7626193761825562], [0.41155871748924255, -0.7856552004814148], [0.5193068385124207, -0.7973781824111938], [0.6210421323776245, -0.7998092174530029], [0.7168033123016357, -0.7945097088813782], [0.8067174553871155, -0.7827054858207703], [0.8909517526626587, -0.7653744220733643], [0.9696879982948303, -0.7433083057403564], [1.0431071519851685, -0.7171580195426941], [1.111382007598877, -0.6874650716781616], [1.174676537513733, -0.6546860933303833], [1.2331398725509644, -0.619210958480835], [1.2869088649749756, -0.5813753604888916], [1.336106777191162, -0.541472315788269], [1.3808444738388062, -0.49975985288619995], [1.4212207794189453, -0.45646733045578003], [1.457323431968689, -0.4118008017539978], [1.4892289638519287, -0.36594724655151367], [1.5170044898986816, -0.3190779685974121], [1.5407073497772217, -0.27135133743286133], [1.5603851079940796, -0.22291529178619385], [1.5760774612426758, -0.17390947043895721], [1.5878161191940308, -0.12446703016757965], [1.5956237316131592, -0.07471625506877899], [1.5995163917541504, -0.024781998246908188], [1.5995010137557983, 0.0252128466963768], [1.5955779552459717, 0.07514604926109314], [1.5877389907836914, 0.12489470839500427], [1.5759690999984741, 0.17433393001556396], [1.5602455139160156, 0.2233354151248932], [1.5405360460281372, 0.2717660069465637], [1.5168015956878662, 0.31948596239089966], [1.4889940023422241, 0.36634716391563416], [1.4570553302764893, 0.412191241979599], [1.4209192991256714, 0.45684683322906494], [1.380509614944458, 0.5001268982887268], [1.3357373476028442, 0.5418250560760498], [1.2865042686462402, 0.5817117691040039], [1.2326995134353638, 0.6195287704467773], [1.1741994619369507, 0.6549831032752991], [1.110866904258728, 0.6877381801605225], [1.0425525903701782, 0.7174040675163269], [0.9690935015678406, 0.7435232996940613], [0.8903160691261292, 0.7655536532402039], [0.8060390949249268, 0.782843291759491], [0.7160813212394714, 0.7945994138717651], [0.6202754974365234, 0.7998426556587219], [0.5184952616691589, 0.797344982624054], [0.41070276498794556, 0.7855417728424072], [0.29704177379608154, 0.7624081969261169], [0.17801330983638763, 0.7252860069274902], [0.05481906235218048, 0.6706581711769104], [-0.06996242702007294, 0.5939186811447144], [-0.19107328355312347, 0.48937851190567017], [-0.2983752191066742, 0.351382851600647], [-0.3747571110725403, 0.17860940098762512], [-0.3997555077075958, -0.017592398449778557], [-0.36449843645095825, -0.21125729382038116], [-0.2811497449874878, -0.37825867533683777], [-0.1703818440437317, -0.5100549459457397], [-0.048060037195682526, -0.6092594861984253], [0.07672695070505142, -0.6817191243171692], [0.19932599365711212, -0.7329627275466919], [0.3174727261066437, -0.7673925757408142], [0.43012535572052, -0.7883567214012146], [0.5368643403053284, -0.7983871102333069], [0.6375876069068909, -0.799416720867157], [0.7323535680770874, -0.7929431200027466], [0.8212987184524536, -0.7801450490951538], [0.9045941829681396, -0.7619650959968567], [0.9824221134185791, -0.7391684055328369], [1.0549628734588623, -0.7123855352401733], [1.122388482093811, -0.6821425557136536], [1.184859037399292, -0.6488834619522095], [1.2425223588943481, -0.6129879355430603], [1.2955127954483032, -0.5747842192649841], [1.34395170211792, -0.5345588326454163], [1.387947916984558, -0.4925643801689148], [1.4275981187820435, -0.4490262567996979], [1.4629876613616943, -0.40414682030677795], [1.4941926002502441, -0.35811030864715576], [1.5212775468826294, -0.3110855221748352], [1.5442981719970703, -0.26322898268699646], [1.5633015632629395, -0.21468710899353027], [1.5783257484436035, -0.1655983328819275], [1.5894004106521606, -0.11609485000371933], [1.596547245979309, -0.06630423665046692], [1.5997800827026367, -0.016350988298654556], [1.5991058349609375, 0.03364221006631851], [1.5945229530334473, 0.08355312794446945], [1.586022138595581, 0.13325859606266022], [1.5735875368118286, 0.18263326585292816], [1.5571941137313843, 0.23154811561107635], [1.536808729171753, 0.2798689901828766], [1.5123904943466187, 0.3274548351764679], [1.4838902950286865, 0.37415599822998047], [1.451249122619629, 0.4198121726512909], [1.4143980741500854, 0.46424949169158936], [1.373258352279663, 0.5072779059410095], [1.327741026878357, 0.5486874580383301], [1.2777447700500488, 0.5882440805435181], [1.2231568098068237, 0.625684380531311], [1.1638516187667847, 0.660708487033844], [1.0996897220611572, 0.6929712891578674], [1.0305191278457642, 0.722072958946228], [0.9561752676963806, 0.7475429177284241], [0.8764827847480774, 0.7688226699829102], [0.791259765625, 0.7852389216423035], [0.7003263235092163, 0.795970618724823], [0.603519856929779, 0.8000013828277588], [0.5007242560386658, 0.7960537672042847], [0.39192458987236023, 0.782495379447937], [0.2773091197013855, 0.7572081089019775], [0.15746670961380005, 0.7174054384231567], [0.03377123177051544, 0.6594014763832092], [-0.09086036682128906, 0.5783924460411072], [-0.21052512526512146, 0.4685635268688202], [-0.3140040636062622, 0.32456210255622864], [-0.3830711543560028, 0.14656952023506165], [-0.39794108271598816, -0.05126200616359711], [-0.35324153304100037, -0.24175210297107697], [-0.2638496458530426, -0.40298667550086975], [-0.1502235233783722, -0.5289342403411865], [-0.027001377195119858, -0.623200535774231], [0.09765742719173431, -0.6917200088500977], [0.21961992979049683, -0.7398481965065002], [0.3368900418281555, -0.7717955708503723], [0.44856250286102295, -0.7907553315162659], [0.5542874932289124, -0.7991445064544678], [0.6539981961250305, -0.7988123893737793], [0.7477706670761108, -0.7911958694458008], [0.8357498049736023, -0.7774284482002258], [0.9181095957756042, -0.7584195137023926], [0.995032548904419, -0.7349088788032532], [1.0666977167129517, -0.7075074911117554], [1.1332756280899048, -0.6767259240150452], [1.1949244737625122, -0.6429964900016785], [1.2517898082733154, -0.6066896915435791], [1.304003357887268, -0.5681257247924805], [1.3516845703125, -0.5275845527648926], [1.3949404954910278, -0.48531436920166016], [1.4338659048080444, -0.4415360391139984], [1.4685444831848145, -0.39644867181777954], [1.4990496635437012, -0.35023367404937744], [1.5254449844360352, -0.3030576705932617], [1.547784447669983, -0.25507527589797974], [1.5661132335662842, -0.20643147826194763], [1.5804685354232788, -0.15726350247859955], [1.5908783674240112, -0.10770261287689209], [1.5973631143569946, -0.057875826954841614], [1.5999364852905273, -0.00790719036012888], [1.598602533340454, 0.04208076745271683], [1.593359112739563, 0.09196573495864868], [1.5841953754425049, 0.14162427186965942], [1.571094274520874, 0.1909305453300476], [1.5540289878845215, 0.23975469172000885], [1.5329660177230835, 0.28796157240867615], [1.507861852645874, 0.33540889620780945], [1.4786664247512817, 0.38194525241851807], [1.4453189373016357, 0.4274081885814667], [1.4077486991882324, 0.47162139415740967], [1.3658759593963623, 0.5143917798995972], [1.3196091651916504, 0.5555053949356079], [1.2688459157943726, 0.5947239398956299], [1.213470220565796, 0.6317781805992126], [1.1533539295196533, 0.6663612127304077], [1.088356614112854, 0.6981199383735657], [1.0183236598968506, 0.7266431450843811], [0.9430885910987854, 0.7514471411705017], [0.8624744415283203, 0.7719558477401733], [0.776298999786377, 0.7874737977981567], [0.6843835115432739, 0.7971508502960205], [0.5865709781646729, 0.7999317646026611], [0.48275768756866455, 0.7944861054420471], [0.3729538917541504, 0.7791102528572083], [0.2573982775211334, 0.7515872120857239], [0.1367781162261963, 0.7089959979057312], [0.01266062818467617, 0.6474738717079163], [-0.1116582602262497, 0.5620208978652954], [-0.22956086695194244, 0.4467318058013916], [-0.32868215441703796, 0.29669734835624695], [-0.3898138105869293, 0.11387781798839569], [-0.39436784386634827, -0.08475443720817566], [-0.34068381786346436, -0.27141237258911133], [-0.24585148692131042, -0.42672163248062134], [-0.1297796070575714, -0.5469326376914978], [-0.005882609635591507, -0.6364290714263916], [0.11853399127721786, -0.701156497001648], [0.23980431258678436, -0.7462847232818604], [0.35617196559906006, -0.7758368253707886], [0.4668537378311157, -0.7928577661514282], [0.571561872959137, -0.7996557950973511], [0.6702611446380615, -0.7980011105537415], [0.7630431652069092, -0.789272129535675], [0.8500598073005676, -0.7745599150657654], [0.9314877390861511, -0.7547419667243958], [1.0075095891952515, -0.73053377866745], [1.078303337097168, -0.7025274038314819], [1.144037127494812, -0.6712188720703125], [1.2048677206039429, -0.637029230594635], [1.2609378099441528, -0.6003192067146301], [1.3123774528503418, -0.5614020228385925], [1.35930335521698, -0.520551860332489], [1.4018206596374512, -0.47801172733306885], [1.440022587776184, -0.43399858474731445], [1.4739906787872314, -0.388708233833313], [1.503796935081482, -0.34231942892074585], [1.5295029878616333, -0.29499655961990356], [1.5511614084243774, -0.24689240753650665], [1.5688161849975586, -0.19815044105052948], [1.582502841949463, -0.1489068567752838], [1.5922478437423706, -0.09929210692644119], [1.5980706214904785, -0.04943258315324783], [1.599982738494873, 0.0005479832179844379], [1.597988247871399, 0.05052720010280609], [1.5920827388763428, 0.10038267076015472], [1.5822545289993286, 0.14999061822891235], [1.5684846639633179, 0.19922463595867157], [1.550745964050293, 0.24795418977737427], [1.52900230884552, 0.29604285955429077], [1.503210425376892, 0.34334710240364075], [1.4733173847198486, 0.3897137939929962], [1.4392614364624023, 0.4349781572818756], [1.4009698629379272, 0.478961318731308], [1.3583611249923706, 0.5214670896530151], [1.3113415241241455, 0.5622780323028564], [1.2598062753677368, 0.6011504530906677], [1.2036380767822266, 0.6378092765808105], [1.1427067518234253, 0.6719409227371216], [1.0768688917160034, 0.7031830549240112], [1.0059682130813599, 0.7311134338378906], [0.9298359751701355, 0.75523442029953], [0.8482939004898071, 0.7749514579772949], [0.7611599564552307, 0.7895463109016418], [0.6682573556900024, 0.7981376051902771], [0.5694350600242615, 0.7996293306350708], [0.46460336446762085, 0.7926359176635742], [0.3538011610507965, 0.7753778100013733], [0.23732352256774902, 0.7455338835716248], [0.1159680187702179, 0.7000414133071899], [-0.008481144905090332, 0.6348549127578735], [-0.13230367004871368, 0.5447818636894226], [-0.24809391796588898, 0.4238744378089905], [-0.34228935837745667, 0.2678336799144745], [-0.39489874243736267, 0.08067432790994644], [-0.38907453417778015, -0.11790576577186584], [-0.326936811208725, -0.30015918612480164], [-0.22724910080432892, -0.4494551718235016], [-0.1091093122959137, -0.5640659928321838], [0.01526038907468319, -0.648963451385498], [0.13933350145816803, -0.7100443840026855], [0.2598627209663391, -0.7522855997085571], [0.3753058612346649, -0.7795277237892151], [0.48498815298080444, -0.794674813747406], [0.588677704334259, -0.7999314665794373], [0.6863673329353333, -0.7969926595687866], [0.7781625390052795, -0.787182092666626], [0.8642211556434631, -0.771550178527832], [0.9447221755981445, -0.750943660736084], [1.0198475122451782, -0.7260549068450928], [1.0897741317749023, -0.697458028793335], [1.1546685695648193, -0.6656351685523987], [1.2146843671798706, -0.6309957504272461], [1.2699629068374634, -0.5938922762870789], [1.320631742477417, -0.5546303987503052], [1.3668055534362793, -0.513478696346283], [1.4085873365402222, -0.47067540884017944], [1.4460681676864624, -0.42643341422080994], [1.4793283939361572, -0.3809458017349243], [1.5084372758865356, -0.33438822627067566], [1.5334562063217163, -0.28692325949668884], [1.5544353723526, -0.23870187997817993], [1.5714175701141357, -0.18986618518829346], [1.5844365358352661, -0.14055128395557404], [1.5935181379318237, -0.09088682383298874], [1.5986802577972412, -0.04099863022565842], [1.5999327898025513, 0.008989887312054634], [1.5972785949707031, 0.05895644426345825], [1.5907114744186401, 0.10877853631973267], [1.5802193880081177, 0.15833202004432678], [1.5657814741134644, 0.20748978853225708], [1.5473695993423462, 0.256120502948761], [1.5249464511871338, 0.30408671498298645], [1.4984666109085083, 0.35124337673187256], [1.4678757190704346, 0.3974355459213257], [1.4331098794937134, 0.44249647855758667], [1.39409601688385, 0.4862443208694458], [1.3507499694824219, 0.5284796953201294], [1.302976369857788, 0.5689809918403625], [1.2506682872772217, 0.607499897480011], [1.1937060356140137, 0.643755316734314], [1.131957769393921, 0.6774258017539978], [1.0652775764465332, 0.70814049243927], [0.9935071468353271, 0.7354654669761658], [0.9164754748344421, 0.7588881254196167], [0.8340033888816833, 0.777795672416687], [0.7459086179733276, 0.7914448380470276], [0.65201735496521, 0.7989224195480347], [0.5521857142448425, 0.7990896701812744], [0.44633981585502625, 0.7905028462409973], [0.33455049991607666, 0.7713028192520142], [0.21717548370361328, 0.7390589118003845], [0.09513583779335022, 0.6905601620674133], [-0.0295417383313179, 0.6215732097625732], [-0.1526649296283722, 0.5267213582992554], [-0.2659672796726227, 0.4000762701034546], [-0.35466331243515015, 0.23813974857330322], [-0.39825037121772766, 0.047232139855623245], [-0.38215044140815735, -0.15044774115085602], [-0.31216883659362793, -0.32783350348472595], [-0.20819911360740662, -0.4711112380027771], [-0.08834046125411987, -0.5802940130233765], [0.03632103651762009, -0.6607785224914551], [0.15996325016021729, -0.7183663845062256], [0.2797120213508606, -0.7578381299972534], [0.39421531558036804, -0.7828590869903564], [0.5028955936431885, -0.7961997389793396], [0.6055700182914734, -0.7999671101570129], [0.7022567987442017, -0.7957853078842163], [0.7930728197097778, -0.7849259376525879], [0.8781817555427551, -0.7684004902839661], [0.9577637314796448, -0.747026801109314], [1.0320005416870117, -0.7214753031730652], [1.1010674238204956, -0.6923027634620667], [1.165128469467163, -0.659977912902832], [1.22433602809906, -0.6248999238014221], [1.2788288593292236, -0.5874121785163879], [1.3287323713302612, -0.5478139519691467], [1.3741587400436401, -0.5063679218292236], [1.415209412574768, -0.46330779790878296], [1.4519730806350708, -0.41884297132492065], [1.4845287799835205, -0.37316304445266724], [1.5129444599151611, -0.32644155621528625], [1.5372791290283203, -0.2788386940956116], [1.5575817823410034, -0.23050405085086823], [1.573893666267395, -0.18157833814620972], [1.586247205734253, -0.1321956366300583]];
        const energyHistory = [-0.5, -0.4999999701976776, -0.5, -0.4999999403953552, -0.5, -0.5, -0.5000000596046448, -0.5, -0.4999999701976776, -0.4999997615814209, -0.4999997019767761, -0.4999998211860657, -0.4999997615814209, -0.4999999403953552, -0.49999988079071045, -0.4999999701976776, -0.49999985098838806, -0.5000000596046448, -0.5, -0.4999999701976776, -0.5000001192092896, -0.5, -0.4999997019767761, -0.4999999403953552, -0.5000002980232239, -0.5000001192092896, -0.5000001192092896, -0.49999988079071045, -0.5, -0.4999995231628418, -0.4999990463256836, -0.4999980926513672, -0.49999773502349854, -0.4999980926513672, -0.49999749660491943, -0.499997615814209, -0.49999797344207764, -0.4999980926513672, -0.4999983310699463, -0.4999980330467224, -0.49999767541885376, -0.4999973773956299, -0.4999975562095642, -0.49999764561653137, -0.4999975860118866, -0.4999975860118866, -0.499997615814209, -0.49999743700027466, -0.49999740719795227, -0.4999973177909851, -0.49999743700027466, -0.4999975264072418, -0.49999740719795227, -0.49999749660491943, -0.4999975264072418, -0.4999975860118866, -0.499997615814209, -0.49999764561653137, -0.49999767541885376, -0.4999977946281433, -0.49999773502349854, -0.4999977946281433, -0.49999797344207764, -0.49999791383743286, -0.4999978840351105, -0.49999791383743286, -0.49999791383743286, -0.4999978542327881, -0.49999770522117615, -0.49999767541885376, -0.499997615814209, -0.49999767541885376, -0.49999767541885376, -0.49999773502349854, -0.4999977946281433, -0.4999978542327881, -0.4999982416629791, -0.4999981224536896, -0.49999815225601196, -0.4999983310699463, -0.4999982714653015, -0.4999982416629791, -0.4999982714653015, -0.4999983310699463, -0.49999845027923584, -0.4999985098838806, -0.49999862909317017, -0.4999985098838806, -0.49999845027923584, -0.4999988079071045, -0.4999990463256836, -0.49999892711639404, -0.4999978542327881, -0.4999973773956299, -0.49999821186065674, -0.499997615814209, -0.49999821186065674, -0.4999983310699463, -0.49999773502349854, -0.49999725818634033, -0.49999749660491943, -0.4999975562095642, -0.49999719858169556, -0.4999971389770508, -0.49999698996543884, -0.4999971091747284, -0.4999968111515045, -0.49999698996543884, -0.49999716877937317, -0.4999971389770508, -0.49999716877937317, -0.4999973773956299, -0.49999746680259705, -0.49999767541885376, -0.49999773502349854, -0.4999978244304657, -0.49999797344207764, -0.49999797344207764, -0.4999980926513672, -0.49999815225601196, -0.4999980330467224, -0.4999980926513672, -0.49999839067459106, -0.49999818205833435, -0.4999983012676239, -0.4999983012676239, -0.4999982714653015, -0.49999839067459106, -0.4999983310699463, -0.49999839067459106, -0.49999839067459106, -0.49999845027923584, -0.4999985098838806, -0.4999983310699463, -0.49999845027923584, -0.49999845027923584, -0.4999985098838806, -0.4999985694885254, -0.49999839067459106, -0.4999983310699463, -0.4999982416629791, -0.4999983310699463, -0.49999845027923584, -0.49999818205833435, -0.4999982416629791, -0.49999815225601196, -0.4999980032444, -0.49999842047691345, -0.4999982714653015, -0.4999982714653015, -0.4999988079071045, -0.4999988079071045, -0.49999892711639404, -0.4999988079071045, -0.49999892711639404, -0.49999845027923584, -0.4999978542327881, -0.4999985694885254, -0.4999990463256836, -0.5, -0.5000001192092896, -0.5000008344650269, -0.5000012516975403, -0.5000013709068298, -0.5000016689300537, -0.5000016689300537, -0.5000019073486328, -0.5000020265579224, -0.5000021457672119, -0.5000022053718567, -0.5000021457672119, -0.5000019073486328, -0.5000016689300537, -0.5000019073486328, -0.5000020265579224, -0.5000019073486328, -0.5000019073486328, -0.500001847743988, -0.5000017881393433, -0.5000017881393433, -0.5000016689300537, -0.5000016093254089, -0.5000015497207642, -0.5000014305114746, -0.5000014901161194, -0.5000015497207642, -0.5000015497207642, -0.5000016093254089, -0.5000015497207642, -0.5000014305114746, -0.5000012516975403, -0.5000012516975403, -0.5000013113021851, -0.5000011920928955, -0.5000011324882507, -0.500001072883606, -0.5000009536743164, -0.500001072883606, -0.500001072883606, -0.5000008940696716, -0.5000010132789612, -0.5000010132789612, -0.500001072883606, -0.5000009536743164, -0.5000008940696716, -0.5000008344650269, -0.5000008344650269, -0.5000008344650269, -0.5000010132789612, -0.5000011920928955, -0.5000013113021851, -0.5000012516975403, -0.5000016689300537, -0.5000017285346985, -0.5000016689300537, -0.5000020265579224, -0.5000013113021851, -0.5000014305114746, -0.5000007152557373, -0.5000015497207642, -0.5000013113021851, -0.5000019073486328, -0.5000026226043701, -0.5000027418136597, -0.500002384185791, -0.5000026226043701, -0.5000025629997253, -0.500002384185791, -0.5000025033950806, -0.5000029802322388, -0.5000030994415283, -0.500002920627594, -0.5000030994415283, -0.5000030994415283, -0.5000030398368835, -0.5000030398368835, -0.5000027418136597, -0.5000028610229492, -0.5000027418136597, -0.5000028014183044, -0.5000026226043701, -0.5000026822090149, -0.5000027418136597, -0.5000029802322388, -0.5000031590461731, -0.5000032186508179, -0.5000033378601074, -0.5000033974647522, -0.5000033974647522, -0.5000033378601074, -0.5000033974647522, -0.5000035762786865, -0.5000035166740417, -0.5000035166740417, -0.5000036358833313, -0.5000035762786865, -0.5000033974647522, -0.5000035166740417, -0.5000036954879761, -0.5000036954879761, -0.5000035166740417, -0.5000035762786865, -0.5000036358833313, -0.5000036358833313, -0.5000036954879761, -0.5000036954879761, -0.5000033378601074, -0.5000036358833313, -0.500003457069397, -0.5000036954879761, -0.5000035166740417, -0.500003457069397, -0.5000036358833313, -0.5000039339065552, -0.5000037550926208, -0.5000033974647522, -0.5000035166740417, -0.500002920627594, -0.5000029802322388, -0.500003457069397, -0.5000039339065552, -0.5000033378601074, -0.5000022649765015, -0.5000022649765015, -0.5000015497207642, -0.5000015497207642, -0.500002384185791, -0.5000029802322388, -0.5000030994415283, -0.5000038743019104, -0.500004231929779, -0.500004231929779, -0.5000045299530029, -0.5000046491622925, -0.500004768371582, -0.5000046491622925, -0.5000044107437134, -0.5000044703483582, -0.5000044107437134, -0.5000045299530029, -0.5000045299530029, -0.5000044703483582, -0.5000046491622925, -0.5000046491622925, -0.5000047087669373, -0.5000045299530029, -0.5000045895576477, -0.5000045299530029, -0.5000045299530029, -0.5000045895576477, -0.5000047087669373, -0.500004768371582, -0.5000046491622925, -0.5000048875808716, -0.5000046491622925, -0.5000046491622925, -0.5000045895576477, -0.5000046491622925, -0.5000044703483582, -0.5000042915344238, -0.5000041127204895, -0.5000044107437134, -0.5000044107437134, -0.5000044703483582, -0.5000046491622925, -0.5000047087669373, -0.5000049471855164, -0.5000045895576477, -0.5000046491622925, -0.5000046491622925, -0.5000044107437134, -0.5000046491622925, -0.5000044107437134, -0.5000045299530029, -0.5000043511390686, -0.5000045299530029, -0.5000041127204895, -0.5000041723251343, -0.5000043511390686, -0.5000038743019104, -0.5000036358833313, -0.5000035762786865, -0.5000035762786865, -0.5000029802322388, -0.5000030994415283, -0.5000036954879761, -0.5000032186508179, -0.5000040531158447, -0.5000038146972656, -0.5000042915344238, -0.5000039339065552, -0.5000038146972656, -0.500004231929779, -0.5000045895576477, -0.5000049471855164, -0.5000050067901611, -0.5000048279762268, -0.5000048875808716, -0.5000048875808716, -0.500004768371582, -0.5000050067901611, -0.5000050663948059, -0.5000052452087402, -0.500005304813385, -0.5000053644180298, -0.500005304813385, -0.5000054836273193, -0.5000055432319641, -0.5000053644180298, -0.5000054240226746, -0.5000053644180298, -0.500005304813385, -0.5000053644180298, -0.5000053644180298, -0.5000051856040955, -0.5000051259994507, -0.500005304813385, -0.5000053644180298, -0.5000053644180298, -0.5000053644180298, -0.5000054240226746, -0.5000054240226746, -0.5000053644180298, -0.5000054836273193, -0.5000055432319641, -0.5000056028366089, -0.5000053644180298, -0.5000054836273193, -0.5000056028366089, -0.5000054836273193, -0.5000054836273193, -0.5000054836273193, -0.5000053644180298, -0.5000053644180298, -0.5000052452087402, -0.5000051259994507, -0.5000050067901611, -0.5000050067901611, -0.5000048875808716, -0.5000045299530029, -0.5000044107437134, -0.5000042915344238, -0.5000041723251343, -0.5000041127204895, -0.5000039339065552, -0.5000032186508179, -0.5000025033950806, -0.5000021457672119, -0.5000014305114746, -0.5000015497207642, -0.5000019073486328, -0.5000019073486328, -0.5000015497207642, -0.5000015497207642, -0.5000013113021851, -0.5000015497207642, -0.5000017285346985, -0.5000017285346985, -0.5000022053718567, -0.5000021457672119, -0.5000020265579224, -0.5000019669532776, -0.5000019669532776, -0.5000019073486328, -0.5000019073486328, -0.5000017881393433, -0.5000019073486328, -0.500001847743988, -0.5000019073486328, -0.5000020265579224, -0.5000019669532776, -0.5000020265579224, -0.5000020265579224, -0.5000022649765015, -0.5000022053718567, -0.5000022649765015, -0.500002384185791, -0.500002384185791, -0.5000023245811462, -0.500002384185791, -0.500002384185791, -0.5000022053718567, -0.5000022649765015, -0.5000024437904358, -0.5000025629997253, -0.5000025033950806, -0.5000025033950806, -0.5000025033950806, -0.5000024437904358, -0.5000026226043701, -0.5000026822090149, -0.5000026822090149, -0.5000026226043701, -0.5000025629997253, -0.5000026822090149, -0.5000027418136597, -0.5000025629997253, -0.5000023245811462, -0.5000019669532776, -0.5000016689300537, -0.5000016689300537, -0.5000016689300537, -0.5000017881393433, -0.5000020861625671, -0.5000019073486328, -0.5000021457672119, -0.5000022649765015, -0.5000028610229492, -0.5000022649765015, -0.5000021457672119, -0.5000015497207642, -0.5000008344650269, -0.5000003576278687, -0.5000007152557373, -0.5000009536743164, -0.5000014305114746, -0.5000017881393433, -0.5000020265579224, -0.500001847743988, -0.5000013113021851, -0.5000012516975403, -0.500001072883606, -0.5000009536743164, -0.5000008344650269, -0.5000008344650269, -0.5000011324882507, -0.5000013113021851, -0.5000014305114746, -0.5000016689300537, -0.5000016689300537, -0.5000015497207642, -0.5000013709068298, -0.5000015497207642, -0.5000014305114746, -0.5000015497207642, -0.5000014901161194, -0.5000014305114746, -0.5000013709068298, -0.5000013709068298, -0.5000014305114746, -0.5000014305114746];
        const E_start = -0.5;
        const ecc = 0.6;
        const semiMajor = 1.0;

        // State
        let frame = 0;
        let playing = true;
        let speed = 5;

        // Canvas setup
        const canvas = document.getElementById('orbitCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 130;

        // Energy chart
        const eCanvas = document.getElementById('energyChart');
        const ectx = eCanvas.getContext('2d');

        // Controls
        document.getElementById('playBtn').onclick = () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? 'Pause' : 'Play';
        };
        document.getElementById('resetBtn').onclick = () => { frame = 0; };
        document.getElementById('speedSlider').oninput = (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedLabel').textContent = speed + 'x';
        };

        function drawOrbit() {
            // Clear
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars background
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 100; i++) {
                const x = (Math.sin(i * 123.456) * 0.5 + 0.5) * canvas.width;
                const y = (Math.cos(i * 654.321) * 0.5 + 0.5) * canvas.height;
                const size = Math.random() * 1.5;
                ctx.globalAlpha = 0.3 + Math.random() * 0.4;
                ctx.fillRect(x, y, size, size);
            }
            ctx.globalAlpha = 1;

            // Expected ellipse (faint reference)
            const a_px = semiMajor * scale;
            const b_px = a_px * Math.sqrt(1 - ecc * ecc);
            const c_px = ecc * a_px;
            ctx.strokeStyle = 'rgba(100, 100, 100, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(cx - c_px, cy, a_px, b_px, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // Orbit trail (gradient fade)
            const trailLength = Math.min(frame + 1, 150);
            const startIdx = Math.max(0, frame - trailLength + 1);
            ctx.lineWidth = 2;
            for (let i = startIdx; i < frame; i++) {
                const alpha = (i - startIdx) / trailLength;
                ctx.strokeStyle = `rgba(74, 170, 255, ${alpha * 0.8})`;
                ctx.beginPath();
                const x1 = cx + history[i][0] * scale;
                const y1 = cy - history[i][1] * scale;
                const x2 = cx + history[i + 1][0] * scale;
                const y2 = cy - history[i + 1][1] * scale;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }

            // Sun with glow
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, 40);
            gradient.addColorStop(0, 'rgba(255, 255, 100, 1)');
            gradient.addColorStop(0.3, 'rgba(255, 200, 50, 0.8)');
            gradient.addColorStop(0.6, 'rgba(255, 150, 0, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffee00';
            ctx.beginPath();
            ctx.arc(cx, cy, 12, 0, 2 * Math.PI);
            ctx.fill();

            // Planet
            const pos = history[frame];
            const px = cx + pos[0] * scale;
            const py = cy - pos[1] * scale;

            // Planet glow
            const pGrad = ctx.createRadialGradient(px, py, 0, px, py, 20);
            pGrad.addColorStop(0, 'rgba(74, 170, 255, 0.8)');
            pGrad.addColorStop(0.5, 'rgba(74, 170, 255, 0.2)');
            pGrad.addColorStop(1, 'rgba(74, 170, 255, 0)');
            ctx.fillStyle = pGrad;
            ctx.beginPath();
            ctx.arc(px, py, 20, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#4af';
            ctx.beginPath();
            ctx.arc(px, py, 8, 0, 2 * Math.PI);
            ctx.fill();

            // Velocity indicator
            if (frame < history.length - 1) {
                const nextPos = history[Math.min(frame + 5, history.length - 1)];
                const vx = (nextPos[0] - pos[0]) * 15;
                const vy = (nextPos[1] - pos[1]) * 15;
                ctx.strokeStyle = '#4f4';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(px, py);
                ctx.lineTo(px + vx * scale, py - vy * scale);
                ctx.stroke();
                // Arrow head
                const angle = Math.atan2(-vy, vx);
                ctx.beginPath();
                ctx.moveTo(px + vx * scale, py - vy * scale);
                ctx.lineTo(px + vx * scale - 8 * Math.cos(angle - 0.4), py - vy * scale + 8 * Math.sin(angle - 0.4));
                ctx.moveTo(px + vx * scale, py - vy * scale);
                ctx.lineTo(px + vx * scale - 8 * Math.cos(angle + 0.4), py - vy * scale + 8 * Math.sin(angle + 0.4));
                ctx.stroke();
            }

            // Distance line to sun
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(px, py);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.fillText('Sun', cx + 15, cy - 15);
            ctx.fillStyle = '#4af';
            ctx.fillText('Planet', px + 12, py - 12);
        }

        function drawEnergyChart() {
            ectx.fillStyle = '#000';
            ectx.fillRect(0, 0, eCanvas.width, eCanvas.height);

            const visibleEnergy = energyHistory.slice(0, frame + 1);
            if (visibleEnergy.length < 2) return;

            const eMin = Math.min(...energyHistory);
            const eMax = Math.max(...energyHistory);
            const range = (eMax - eMin) || 1e-10;

            // Reference line (initial energy)
            const yRef = 50 - ((E_start - eMin) / range) * 40;
            ectx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ectx.beginPath();
            ectx.moveTo(0, yRef);
            ectx.lineTo(eCanvas.width, yRef);
            ectx.stroke();

            // Energy line
            ectx.strokeStyle = '#4f4';
            ectx.lineWidth = 1.5;
            ectx.beginPath();
            for (let i = 0; i < visibleEnergy.length; i++) {
                const x = (i / energyHistory.length) * eCanvas.width;
                const y = 50 - ((visibleEnergy[i] - eMin) / range) * 40;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();
        }

        function updateStats() {
            const pos = history[frame];
            const dist = Math.sqrt(pos[0] * pos[0] + pos[1] * pos[1]);

            // Calculate velocity
            let speed_val = 0;
            if (frame < history.length - 1) {
                const next = history[frame + 1];
                const dx = next[0] - pos[0];
                const dy = next[1] - pos[1];
                speed_val = Math.sqrt(dx * dx + dy * dy) * 100; // Scale for display
            }

            const energy = energyHistory[frame];
            const drift = Math.abs(energy - E_start) / Math.abs(E_start);

            document.getElementById('posValue').textContent = `(${pos[0].toFixed(2)}, ${pos[1].toFixed(2)})`;
            document.getElementById('distValue').textContent = dist.toFixed(3);
            document.getElementById('speedValue').textContent = speed_val.toFixed(3);
            document.getElementById('orbitValue').textContent = `${(frame / history.length * 100).toFixed(1)}%`;
            document.getElementById('energyValue').textContent = energy.toFixed(6);
            document.getElementById('driftValue').textContent = drift.toExponential(2);

            // Color code drift
            const driftEl = document.getElementById('driftValue');
            if (drift < 1e-6) {
                driftEl.className = 'stat-value good';
            } else if (drift < 1e-3) {
                driftEl.className = 'stat-value warn';
            } else {
                driftEl.className = 'stat-value';
                driftEl.style.color = '#f44';
            }
        }

        function animate() {
            drawOrbit();
            drawEnergyChart();
            updateStats();

            if (playing) {
                frame = (frame + speed) % history.length;
            }

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
    