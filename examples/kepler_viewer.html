
<!DOCTYPE html>
<html>
<head>
    <title>Kepler Problem - TinyPhysics</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #eee;
            margin: 0;
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            font-weight: 300;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .main-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1400px;
            margin: 0 auto;
        }
        .orbit-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            background: #4af;
            border: none;
            color: #000;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        button:hover { background: #5bf; transform: scale(1.05); }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
        }
        input[type="range"] {
            width: 100px;
            accent-color: #4af;
        }
        .stats-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 10px;
            padding: 20px;
            min-width: 320px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .stat-group {
            margin-bottom: 20px;
        }
        .stat-group h3 {
            color: #4af;
            margin: 0 0 12px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-label { color: #888; }
        .stat-value { color: #fff; font-family: monospace; }
        .stat-value.good { color: #4f4; }
        .stat-value.warn { color: #fa4; }
        .kepler-law {
            background: rgba(74, 170, 255, 0.1);
            border-left: 3px solid #4af;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        .kepler-law .title {
            color: #4af;
            font-weight: bold;
            font-size: 12px;
        }
        .kepler-law .desc {
            color: #aaa;
            font-size: 12px;
            margin-top: 4px;
        }
        .formula {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 4px;
            color: #4f4;
            display: inline-block;
            margin: 5px 0;
        }
        .chart-container {
            margin-top: 15px;
        }
        .chart-container h4 {
            color: #888;
            font-size: 12px;
            margin: 0 0 8px 0;
        }
        .mini-chart {
            background: #000;
            border-radius: 5px;
            height: 60px;
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Kepler Problem</h1>
    <div class="subtitle">Two-body gravitational orbit simulated from Hamiltonian mechanics</div>

    <div class="main-container">
        <div class="orbit-section">
            <canvas id="orbitCanvas" width="550" height="550"></canvas>
            <div class="controls">
                <button id="playBtn">Pause</button>
                <button id="resetBtn">Reset</button>
                <div class="speed-control">
                    <span>Speed:</span>
                    <input type="range" id="speedSlider" min="1" max="20" value="5">
                    <span id="speedLabel">5x</span>
                </div>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-group">
                <h3>Current State</h3>
                <div class="stat-row">
                    <span class="stat-label">Position (x, y)</span>
                    <span class="stat-value" id="posValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Distance from Sun</span>
                    <span class="stat-value" id="distValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Speed</span>
                    <span class="stat-value" id="speedValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Orbit Progress</span>
                    <span class="stat-value" id="orbitValue">-</span>
                </div>
            </div>

            <div class="stat-group">
                <h3>Conservation Laws</h3>
                <div class="stat-row">
                    <span class="stat-label">Total Energy</span>
                    <span class="stat-value good" id="energyValue">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Energy Drift</span>
                    <span class="stat-value good" id="driftValue">-</span>
                </div>
                <div class="chart-container">
                    <h4>Energy over time</h4>
                    <canvas id="energyChart" class="mini-chart" width="280" height="60"></canvas>
                </div>
            </div>

            <div class="stat-group">
                <h3>Orbital Parameters</h3>
                <div class="stat-row">
                    <span class="stat-label">Semi-major axis (a)</span>
                    <span class="stat-value">1.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Eccentricity (e)</span>
                    <span class="stat-value">0.60</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Perihelion</span>
                    <span class="stat-value">0.40</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Aphelion</span>
                    <span class="stat-value">1.60</span>
                </div>
            </div>

            <div class="kepler-law">
                <div class="title">How it works</div>
                <div class="desc">Only the Hamiltonian is defined:</div>
                <div class="formula">H = pÂ²/2m - GMm/r</div>
                <div class="desc">Equations of motion derived via autograd. Symplectic integrator preserves energy.</div>
            </div>
        </div>
    </div>

    <script>
        const history = [[1.600000023841858, 0.0], [1.5980761051177979, 0.04998956248164177], [1.592212200164795, 0.09984666854143143], [1.5824261903762817, 0.14945761859416962], [1.5686988830566406, 0.1986960619688034], [1.551003098487854, 0.2474314421415329], [1.5293034315109253, 0.2955275774002075], [1.5035557746887207, 0.34284088015556335], [1.473707914352417, 0.38921844959259033], [1.4396976232528687, 0.4344957172870636], [1.4014531373977661, 0.478493869304657], [1.3588926792144775, 0.5210168957710266], [1.311922550201416, 0.5618475079536438], [1.2604382038116455, 0.6007425785064697], [1.204322338104248, 0.637427806854248], [1.1434452533721924, 0.6715895533561707], [1.0776634216308594, 0.7028661966323853], [1.006820797920227, 0.7308365106582642], [0.9307486414909363, 0.7550034523010254], [0.8492690920829773, 0.7747740149497986], [0.7621995210647583, 0.7894313335418701], [0.6693635582923889, 0.7980962991714478], [0.5706095695495605, 0.7996756434440613], [0.4658468961715698, 0.7927876710891724], [0.35511234402656555, 0.7756579518318176], [0.23869694769382477, 0.7459725141525269], [0.11739052087068558, 0.7006781101226807], [-0.0070380112156271935, 0.6357415318489075], [-0.13089802861213684, 0.5459815859794617], [-0.2468375265598297, 0.4254498779773712], [-0.3413710594177246, 0.2697974443435669], [-0.39454102516174316, 0.08289080858230591], [-0.3893495202064514, -0.11574213951826096], [-0.32765862345695496, -0.29830875992774963], [-0.2281557023525238, -0.44797226786613464], [-0.11002406477928162, -0.562879741191864], [0.014422567561268806, -0.6479814648628235], [0.13860423862934113, -0.709190309047699], [0.25924795866012573, -0.7515034675598145], [0.37480005621910095, -0.7787784934043884], [0.48458147048950195, -0.793931782245636], [0.5883587598800659, -0.7991762757301331], [0.686124861240387, -0.7962128520011902], [0.7779858708381653, -0.7863694429397583], [0.8641006350517273, -0.7706993818283081], [0.9446488618850708, -0.7500514388084412], [1.019813895225525, -0.7251197695732117], [1.089773178100586, -0.6964795589447021], [1.154693603515625, -0.6646137237548828], [1.2147302627563477, -0.6299328804016113], [1.2700247764587402, -0.5927892923355103], [1.3207052946090698, -0.5534895062446594], [1.3668869733810425, -0.5123023986816406], [1.4086730480194092, -0.4694661498069763], [1.4461551904678345, -0.42519411444664], [1.4794142246246338, -0.3796791732311249], [1.5085203647613525, -0.3330974876880646], [1.5335339307785034, -0.28561142086982727], [1.5545066595077515, -0.23737214505672455], [1.5714809894561768, -0.1885218322277069], [1.58449125289917, -0.13919557631015778], [1.5935633182525635, -0.08952311426401138], [1.5987153053283691, -0.03963029012084007], [1.599957823753357, 0.01035953126847744], [1.5972936153411865, 0.0603240430355072], [1.5907173156738281, 0.11014071851968765], [1.5802167654037476, 0.15968546271324158], [1.565771460533142, 0.2088312953710556], [1.54735267162323, 0.2574467658996582], [1.5249245166778564, 0.30539464950561523], [1.498441457748413, 0.3525297939777374], [1.467849612236023, 0.39869746565818787], [1.4330856800079346, 0.443730890750885], [1.3940764665603638, 0.4874486029148102], [1.350738286972046, 0.5296512246131897], [1.302976369857788, 0.5701173543930054], [1.2506842613220215, 0.608599066734314], [1.193743348121643, 0.6448156237602234], [1.1320213079452515, 0.6784462928771973], [1.0653736591339111, 0.7091202735900879], [0.9936423897743225, 0.7364047169685364], [0.9166579842567444, 0.7597882151603699], [0.8342418670654297, 0.7786589860916138], [0.7462126612663269, 0.7922760844230652], [0.6523974537849426, 0.7997291088104248], [0.5526532530784607, 0.7998824119567871], [0.44690656661987305, 0.791297435760498], [0.33522772789001465, 0.7721220850944519], [0.2179720401763916, 0.7399356961250305], [0.09605337679386139, 0.6915413737297058], [-0.028517894446849823, 0.6227242946624756], [-0.15158464014530182, 0.5281274318695068], [-0.264947772026062, 0.40182656049728394], [-0.35391750931739807, 0.24026207625865936], [-0.39801838994026184, 0.04957227408885956], [-0.38246938586235046, -0.14821843802928925], [-0.31279972195625305, -0.32594454288482666], [-0.2088664323091507, -0.4695601761341095], [-0.08888331055641174, -0.5789682269096375], [0.03596419841051102, -0.659561276435852], [0.15980122983455658, -0.7171692252159119], [0.2797306478023529, -0.756600022315979], [0.3943919837474823, -0.7815402746200562], [0.5032056570053101, -0.7947750687599182], [0.6059897541999817, -0.7984214425086975], [0.702764093875885, -0.7941101789474487], [0.7936484217643738, -0.7831175923347473], [0.8788079619407654, -0.7664588093757629], [0.9584251046180725, -0.7449538111686707], [1.032683253288269, -0.719274640083313], [1.1017595529556274, -0.6899793148040771], [1.1658194065093994, -0.6575375199317932], [1.2250161170959473, -0.6223487854003906], [1.279489517211914, -0.5847573280334473], [1.3293660879135132, -0.5450624227523804], [1.374759554862976, -0.5035274028778076], [1.4157711267471313, -0.46038585901260376], [1.452491283416748, -0.4158473610877991], [1.4849988222122192, -0.3701016902923584], [1.5133628845214844, -0.32332247495651245], [1.537642478942871, -0.2756699025630951], [1.5578879117965698, -0.22729352116584778], [1.5741405487060547, -0.1783340871334076], [1.5864331722259521, -0.12892569601535797], [1.5947909355163574, -0.07919725030660629], [1.5992306470870972, -0.02927408367395401], [1.5997614860534668, 0.02072068862617016], [1.5963852405548096, 0.07066482305526733], [1.5890960693359375, 0.12043563276529312], [1.5778800249099731, 0.16990862786769867], [1.5627154111862183, 0.2189561277627945], [1.543573021888733, 0.267445832490921], [1.5204150676727295, 0.31523922085762024], [1.4931949377059937, 0.36218973994255066], [1.461857557296753, 0.40814074873924255], [1.4263381958007812, 0.452923059463501], [1.3865621089935303, 0.4963524639606476], [1.3424444198608398, 0.5382261276245117], [1.2938885688781738, 0.5783184170722961], [1.2407863140106201, 0.6163763999938965], [1.1830172538757324, 0.6521131992340088], [1.1204477548599243, 0.6852000951766968], [1.0529311895370483, 0.7152568697929382], [0.9803082942962646, 0.7418388724327087], [0.9024083614349365, 0.7644193768501282], [0.8190527558326721, 0.7823675870895386], [0.7300615906715393, 0.7949169874191284], [0.6352662444114685, 0.801124095916748], [0.5345333218574524, 0.7998090982437134], [0.4278086721897125, 0.789473831653595], [0.3152000308036804, 0.768184244632721], [0.1971345692873001, 0.7334077954292297], [0.07466486096382141, 0.6817970871925354], [-0.04992910474538803, 0.6089520454406738], [-0.17197157442569733, 0.5093531608581543], [-0.2823430001735687, 0.3771764934062958], [-0.36514806747436523, 0.20986272394657135], [-0.3997229039669037, 0.01604338176548481], [-0.3739919662475586, -0.1800824999809265], [-0.2969445586204529, -0.35256919264793396], [-0.18910428881645203, -0.4901474714279175], [-0.06758413463830948, -0.5942108035087585], [0.0574975460767746, -0.6704574227333069], [0.1809048056602478, -0.7245976328849792], [0.3000771701335907, -0.7612488269805908], [0.41382694244384766, -0.7839326858520508], [0.5216636061668396, -0.7953094840049744], [0.6234515309333801, -0.7974048852920532], [0.7192344665527344, -0.7917831540107727], [0.8091440200805664, -0.7796716094017029], [0.8933510780334473, -0.7620490789413452], [0.9720401763916016, -0.7397077679634094], [1.0453946590423584, -0.7132986187934875], [1.113590955734253, -0.6833633184432983], [1.1767933368682861, -0.6503586173057556], [1.2351529598236084, -0.6146737337112427], [1.2888078689575195, -0.5766445398330688], [1.3378829956054688, -0.5365638136863708], [1.3824899196624756, -0.4946891963481903], [1.4227291345596313, -0.45124998688697815], [1.4586886167526245, -0.40645214915275574], [1.4904462099075317, -0.3604823350906372], [1.5180693864822388, -0.3135116994380951], [1.5416158437728882, -0.26569849252700806], [1.5611344575881958, -0.21719051897525787], [1.5766656398773193, -0.16812734305858612], [1.5882412195205688, -0.11864199489355087], [1.5958846807479858, -0.06886270642280579], [1.599611759185791, -0.018914300948381424], [1.599431037902832, 0.03108035773038864], [1.5953428745269775, 0.08099903166294098], [1.5873401165008545, 0.13071882724761963], [1.5754077434539795, 0.18011480569839478], [1.559523344039917, 0.22905859351158142], [1.5396560430526733, 0.27741697430610657], [1.515766978263855, 0.32505011558532715], [1.4878084659576416, 0.37180984020233154], [1.4557238817214966, 0.417537659406662], [1.4194471836090088, 0.4620620012283325], [1.3789024353027344, 0.5051955580711365], [1.3340027332305908, 0.5467320680618286], [1.2846503257751465, 0.5864415764808655], [1.2307353019714355, 0.6240658760070801], [1.1721352338790894, 0.6593115329742432], [1.1087145805358887, 0.6918419599533081], [1.0403255224227905, 0.7212669849395752], [0.9668073654174805, 0.7471294403076172], [0.8879883289337158, 0.7688870429992676], [0.8036898374557495, 0.7858884930610657], [0.7137337923049927, 0.7973412871360779], [0.617956817150116, 0.8022671937942505], [0.5162361860275269, 0.7994398474693298], [0.4085395634174347, 0.7872979044914246], [0.2950165569782257, 0.7638213634490967], [0.17617462575435638, 0.7263596057891846], [0.05322134122252464, 0.6714081168174744], [-0.07126171886920929, 0.5943790078163147], [-0.19202281534671783, 0.4896097481250763], [-0.29894837737083435, 0.3514705002307892], [-0.37496986985206604, 0.17863741517066956], [-0.399632066488266, -0.017589755356311798], [-0.36399149894714355, -0.21126620471477509], [-0.28017404675483704, -0.3781931698322296], [-0.16891197860240936, -0.5097780823707581], [-0.04613794758915901, -0.6086527705192566], [0.07902862131595612, -0.6807063817977905], [0.20192950963974, -0.7315031290054321], [0.3203059732913971, -0.7654697895050049], [0.43312492966651917, -0.7859696745872498], [0.5399757027626038, -0.7955443859100342], [0.6407639384269714, -0.796132504940033], [0.7355547547340393, -0.7892350554466248], [0.824490487575531, -0.7760328054428101], [0.9077469706535339, -0.7574695944786072], [0.9855098724365234, -0.7343114018440247], [1.0579628944396973, -0.7071888446807861], [1.1252810955047607, -0.6766276955604553], [1.1876273155212402, -0.6430721879005432], [1.2451512813568115, -0.6069019436836243], [1.2979893684387207, -0.5684448480606079], [1.3462642431259155, -0.5279868841171265], [1.3900864124298096, -0.48578065633773804], [1.4295538663864136, -0.44205114245414734], [1.46475350856781, -0.39700064063072205], [1.495761752128601, -0.3508130609989166], [1.522644281387329, -0.30365702509880066], [1.5454576015472412, -0.2556888163089752], [1.564249873161316, -0.2070547491312027], [1.5790598392486572, -0.1578931212425232], [1.589917540550232, -0.10833601653575897], [1.596846103668213, -0.05851096287369728], [1.5998601913452148, -0.008542359806597233], [1.5989670753479004, 0.041447144001722336], [1.5941659212112427, 0.09133529663085938], [1.5854483842849731, 0.14099891483783722], [1.572798728942871, 0.19031257927417755], [1.5561929941177368, 0.23914720118045807], [1.5355992317199707, 0.2873685359954834], [1.5109773874282837, 0.3348354697227478], [1.48227858543396, 0.38139817118644714], [1.4494448900222778, 0.42689603567123413], [1.4124088287353516, 0.471155047416687], [1.3710929155349731, 0.5139849781990051], [1.3254084587097168, 0.5551758408546448], [1.2752563953399658, 0.5944932699203491], [1.2205251455307007, 0.631673276424408], [1.16109037399292, 0.6664160490036011], [1.0968152284622192, 0.6983765959739685], [1.0275497436523438, 0.727154552936554], [0.9531322717666626, 0.7522799968719482], [0.8733901977539062, 0.7731937766075134], [0.7881452441215515, 0.7892235517501831], [0.697221577167511, 0.7995493412017822], [0.600461483001709, 0.8031563758850098], [0.49775493144989014, 0.7987696528434753], [0.3890937268733978, 0.7847615480422974], [0.2746742367744446, 0.7590209245681763], [0.15509365499019623, 0.7187730669975281], [0.03173316642642021, 0.6603499054908752], [-0.09248858690261841, 0.5789752006530762], [-0.21168167889118195, 0.46887028217315674], [-0.31466880440711975, 0.32471397519111633], [-0.38328516483306885, 0.1466725915670395], [-0.39774274826049805, -0.051179997622966766], [-0.35256215929985046, -0.2416774481534958], [-0.2625848054885864, -0.402803897857666], [-0.14835162460803986, -0.528472900390625], [-0.0245799757540226, -0.6223198771476746], [0.10053742676973343, -0.6903307437896729], [0.2228633165359497, -0.7379036545753479], [0.3404091000556946, -0.7692775726318359], [0.4522801637649536, -0.7876635193824768], [0.5581372380256653, -0.795490026473999], [0.65792316198349, -0.794613242149353], [0.7517218589782715, -0.7864739298820496], [0.8396850228309631, -0.7722083330154419], [0.9219925403594971, -0.7527270913124084], [0.9988316297531128, -0.7287708520889282], [1.0703855752944946, -0.7009508609771729], [1.1368281841278076, -0.6697776913642883], [1.198320746421814, -0.6356838345527649], [1.2550114393234253, -0.5990389585494995], [1.3070343732833862, -0.5601632595062256], [1.35451078414917, -0.5193367004394531], [1.3975491523742676, -0.4768067002296448], [1.4362462759017944, -0.4327940046787262], [1.4706871509552002, -0.38749757409095764], [1.5009465217590332, -0.34109845757484436], [1.527089238166809, -0.2937629520893097], [1.5491703748703003, -0.24564550817012787], [1.567236304283142, -0.19689089059829712], [1.5813246965408325, -0.14763613045215607], [1.5914652347564697, -0.09801248461008072], [1.5976788997650146, -0.048146821558475494], [1.5999798774719238, 0.001836859155446291], [1.5983737707138062, 0.05181606858968735], [1.592858910560608, 0.10166848450899124], [1.5834258794784546, 0.15127065777778625], [1.5700576305389404, 0.2004966139793396], [1.5527294874191284, 0.24921651184558868], [1.5314081907272339, 0.2972949743270874], [1.5060521364212036, 0.34458962082862854], [1.4766113758087158, 0.39094892144203186], [1.4430266618728638, 0.4362100660800934], [1.4052292108535767, 0.48019659519195557], [1.3631399869918823, 0.522715151309967], [1.3166687488555908, 0.5635517239570618], [1.2657147645950317, 0.6024674773216248], [1.2101646661758423, 0.6391927599906921], [1.1498924493789673, 0.6734207272529602], [1.0847597122192383, 0.7047980427742004], [1.0146148204803467, 0.7329135537147522], [0.939294695854187, 0.757283627986908], [0.8586263060569763, 0.7773322463035583], [0.7724320888519287, 0.7923650145530701], [0.6805387139320374, 0.8015331029891968], [0.5827953815460205, 0.8037834167480469], [0.4791058897972107, 0.7977897524833679], [0.3694894313812256, 0.7818543910980225], [0.25419461727142334, 0.7537705302238464], [0.13391880691051483, 0.710633397102356], [0.010237181559205055, 0.6486051082611084], [-0.11355525255203247, 0.5627228021621704], [-0.23086434602737427, 0.44712814688682556], [-0.3293880224227905, 0.2969454228878021], [-0.3899965286254883, 0.11409629881381989], [-0.3940729796886444, -0.08455592393875122], [-0.3398115634918213, -0.27121782302856445], [-0.24427884817123413, -0.42638108134269714], [-0.12749192118644714, -0.5462429523468018], [-0.0029540760442614555, -0.6352288126945496], [0.12199436128139496, -0.6993458271026611], [0.24368450045585632, -0.7438122034072876], [0.3603694438934326, -0.7726830244064331], [0.4712783694267273, -0.7890238761901855], [0.57613605260849, -0.7951556444168091], [0.6749182939529419, -0.7928561568260193], [0.7677260637283325, -0.783508837223053], [0.8547191619873047, -0.7682077884674072], [0.9360809922218323, -0.7478316426277161], [1.0119996070861816, -0.7230970859527588], [1.0826579332351685, -0.6945964097976685], [1.1482281684875488, -0.6628258228302002], [1.2088701725006104, -0.6282062530517578], [1.2647300958633423, -0.5910981297492981], [1.315940499305725, -0.5518142580986023], [1.3626209497451782, -0.5106285810470581], [1.4048779010772705, -0.46778351068496704], [1.442806601524353, -0.4234957993030548], [1.4764904975891113, -0.3779609799385071], [1.5060030221939087, -0.33135735988616943], [1.5314075946807861, -0.28384914994239807], [1.5527580976486206, -0.23558880388736725], [1.5700993537902832, -0.18671974539756775], [1.5834680795669556, -0.13737784326076508], [1.5928922891616821, -0.08769345283508301], [1.5983924865722656, -0.03779284656047821], [1.5999813079833984, 0.012200338765978813], [1.5976635217666626, 0.06216372922062874], [1.5914362668991089, 0.11197490245103836], [1.5812890529632568, 0.16151009500026703], [1.5672037601470947, 0.2106427401304245], [1.549154281616211, 0.2592422068119049], [1.5271061658859253, 0.3071720004081726], [1.5010170936584473, 0.35428833961486816], [1.4708353281021118, 0.40043795108795166], [1.4365003108978271, 0.4454558491706848], [1.3979419469833374, 0.4891628324985504], [1.3550795316696167, 0.5313623547554016], [1.3078216314315796, 0.571836531162262], [1.2560657262802124, 0.6103417277336121], [1.199696660041809, 0.6466026902198792], [1.1385869979858398, 0.6803052425384521], [1.072596549987793, 0.7110870480537415], [1.0015722513198853, 0.7385262250900269], [0.9253497123718262, 0.7621248960494995], [0.8437557220458984, 0.7812894582748413], [0.7566131949424744, 0.7953024506568909], [0.6637524366378784, 0.8032850623130798], [0.5650302171707153, 0.8041442632675171], [0.46036601066589355, 0.7965000867843628], [0.34980928897857666, 0.7785816192626953], [0.2336667776107788, 0.748081624507904], [0.11274738609790802, 0.7019590139389038], [-0.011157743632793427, 0.6362019777297974], [-0.1343357414007187, 0.5456660389900208], [-0.24942182004451752, 0.4244612455368042], [-0.34294623136520386, 0.26831597089767456], [-0.39500969648361206, 0.08116396516561508], [-0.38868632912635803, -0.11744234710931778], [-0.32590174674987793, -0.2997119128704071], [-0.2254161387681961, -0.44883981347084045], [-0.10646434873342514, -0.5630455613136292], [0.018630826845765114, -0.6473550796508789], [0.14330530166625977, -0.7077357769012451], [0.26430901885032654, -0.7492184638977051], [0.38011035323143005, -0.7756801843643188], [0.4900488555431366, -0.7900481224060059], [0.5939063429832458, -0.7945413589477539], [0.6916880011558533, -0.7908636927604675], [0.7835097908973694, -0.7803443670272827], [0.8695387244224548, -0.7640371322631836], [0.9499610662460327, -0.7427905201911926], [1.0249654054641724, -0.717298150062561], [1.0947335958480835, -0.688134491443634], [1.1594370603561401, -0.6557818651199341], [1.2192338705062866, -0.6206498146057129], [1.2742685079574585, -0.5830901861190796], [1.3246711492538452, -0.5434085726737976], [1.370559811592102, -0.5018730759620667], [1.4120393991470337, -0.4587213695049286], [1.449203372001648, -0.41416627168655396], [1.4821341037750244, -0.3684001863002777], [1.5109031200408936, -0.32159867882728577], [1.5355726480484009, -0.2739238142967224], [1.5561950206756592, -0.22552645206451416], [1.5728141069412231, -0.17654843628406525], [1.5854651927947998, -0.1271246373653412], [1.5941754579544067, -0.07738462090492249], [1.5989640951156616, -0.027454055845737457], [1.5998425483703613, 0.02254372090101242], [1.5968146324157715, 0.07248643040657043], [1.5898761749267578, 0.12225151807069778], [1.5790157318115234, 0.17171481251716614], [1.5642138719558716, 0.22074921429157257], [1.5454435348510742, 0.269223153591156], [1.5226690769195557, 0.31699907779693604], [1.4958466291427612, 0.3639315962791443], [1.4649235010147095, 0.4098656475543976], [1.429837942123413, 0.45463401079177856], [1.3905181884765625, 0.4980548620223999], [1.3468822240829468, 0.5399281978607178], [1.2988368272781372, 0.580032229423523], [1.246277928352356, 0.618118166923523], [1.1890885829925537, 0.6539047956466675], [1.127139925956726, 0.6870706081390381], [1.0602900981903076, 0.7172442674636841], [0.9883845448493958, 0.7439920902252197], [0.9112577438354492, 0.7668018937110901], [0.8287360072135925, 0.7850615978240967], [0.7406439781188965, 0.7980297803878784], [0.6468154788017273, 0.804796040058136], [0.547116219997406, 0.8042256832122803], [0.4414832890033722, 0.79488205909729], [0.3299999237060547, 0.7749172449111938], [0.21303753554821014, 0.7419183850288391], [0.0915294662117958, 0.6927021741867065], [-0.03249204158782959, 0.6230778098106384], [-0.15484941005706787, 0.5277286171913147], [-0.2673359811306, 0.40079259872436523], [-0.3552873730659485, 0.23878653347492218], [-0.3982928395271301, 0.04790491238236427], [-0.3816364109516144, -0.14981526136398315], [-0.31090351939201355, -0.3272111415863037], [-0.2060217410326004, -0.4702702462673187], [-0.08525162935256958, -0.578967809677124], [0.04021568223834038, -0.6587685346603394], [0.16452191770076752, -0.7155531048774719], [0.2847922742366791, -0.7541608214378357], [0.39968740940093994, -0.7782962918281555], [0.5086457133293152, -0.790755033493042], [0.6114999055862427, -0.7936593294143677], [0.7082815170288086, -0.7886427640914917], [0.799119770526886, -0.7769829630851746], [0.8841875791549683, -0.7596954703330994], [0.9636739492416382, -0.7375999689102173], [1.0377674102783203, -0.7113679051399231], [1.1066495180130005, -0.681556761264801], [1.1704896688461304, -0.6486354470252991], [1.2294442653656006, -0.6130027770996094], [1.2836557626724243, -0.575002133846283], [1.333253026008606, -0.534932017326355], [1.3783522844314575, -0.4930550754070282], [1.41905677318573, -0.44960445165634155], [1.455458164215088, -0.40478914976119995], [1.4876371622085571, -0.35879841446876526], [1.515663981437683, -0.31180527806282043], [1.5395994186401367, -0.2639697194099426], [1.5594950914382935, -0.21544088423252106], [1.5753929615020752, -0.1663593202829361], [1.587327241897583, -0.11685885488986969]];
        const energyHistory = [-0.5, -0.49998849630355835, -0.4999884366989136, -0.4999883770942688, -0.4999883770942688, -0.4999883770942688, -0.49998825788497925, -0.499988317489624, -0.49998825788497925, -0.4999881088733673, -0.4999881386756897, -0.49998795986175537, -0.4999879002571106, -0.4999878406524658, -0.49998781085014343, -0.4999876022338867, -0.4999874532222748, -0.4999871253967285, -0.4999869763851166, -0.4999866187572479, -0.4999862611293793, -0.49998578429222107, -0.4999850392341614, -0.4999837279319763, -0.49998146295547485, -0.4999775290489197, -0.4999704360961914, -0.4999561309814453, -0.4999241828918457, -0.49985480308532715, -0.4997241497039795, -0.4995843172073364, -0.49960076808929443, -0.499750018119812, -0.49987101554870605, -0.49993276596069336, -0.4999605417251587, -0.49997377395629883, -0.4999803304672241, -0.4999837279319763, -0.4999857544898987, -0.49998706579208374, -0.49998801946640015, -0.499988317489624, -0.4999889135360718, -0.49998921155929565, -0.49998939037323, -0.49998944997787476, -0.49998974800109863, -0.49998971819877625, -0.49998971819877625, -0.49998974800109863, -0.49998974800109863, -0.4999898374080658, -0.49998989701271057, -0.4999898672103882, -0.499989777803421, -0.4999898672103882, -0.49998989701271057, -0.49998992681503296, -0.4999898672103882, -0.49998992681503296, -0.49998998641967773, -0.49998998641967773, -0.49998992681503296, -0.49998998641967773, -0.49998995661735535, -0.49998995661735535, -0.4999900460243225, -0.49998998641967773, -0.49998998641967773, -0.4999900162220001, -0.4999900460243225, -0.4999900460243225, -0.4999900460243225, -0.4999900460243225, -0.4999900460243225, -0.4999898672103882, -0.4999898374080658, -0.49998968839645386, -0.4999895691871643, -0.49998924136161804, -0.49998900294303894, -0.4999885559082031, -0.4999879002571106, -0.49998700618743896, -0.49998563528060913, -0.4999832510948181, -0.4999791383743286, -0.4999709725379944, -0.49995458126068115, -0.4999178647994995, -0.49983954429626465, -0.4996989965438843, -0.4995737075805664, -0.4996225833892822, -0.49977540969848633, -0.49988555908203125, -0.4999396800994873, -0.4999641180038452, -0.499975323677063, -0.49998098611831665, -0.4999840259552002, -0.49998587369918823, -0.49998700618743896, -0.49998778104782104, -0.49998828768730164, -0.4999886751174927, -0.49998897314071655, -0.49998918175697327, -0.49998921155929565, -0.49998942017555237, -0.4999895691871643, -0.49998971819877625, -0.4999898076057434, -0.4999898374080658, -0.49998992681503296, -0.49998995661735535, -0.4999900460243225, -0.49998998641967773, -0.4999900460243225, -0.49998998641967773, -0.49998998641967773, -0.4999900460243225, -0.49998998641967773, -0.49998998641967773, -0.49998992681503296, -0.49998998641967773, -0.49998995661735535, -0.4999898672103882, -0.49998992681503296, -0.4999898672103882, -0.4999898672103882, -0.4999898076057434, -0.4999898672103882, -0.4999898374080658, -0.4999898374080658, -0.4999898076057434, -0.49998974800109863, -0.49998968839645386, -0.4999895393848419, -0.49998939037323, -0.4999893605709076, -0.49998918175697327, -0.49998894333839417, -0.4999885559082031, -0.4999881684780121, -0.49998751282691956, -0.4999867081642151, -0.4999852180480957, -0.4999827742576599, -0.49997830390930176, -0.4999690055847168, -0.4999504089355469, -0.49990904331207275, -0.4998202323913574, -0.4996730089187622, -0.49956774711608887, -0.49964630603790283, -0.49979841709136963, -0.49989771842956543, -0.49994540214538574, -0.499966561794281, -0.4999770522117615, -0.4999823570251465, -0.49998509883880615, -0.49998682737350464, -0.4999878704547882, -0.49998852610588074, -0.4999890625476837, -0.49998944997787476, -0.49998965859413147, -0.49998992681503296, -0.4999900460243225, -0.4999901056289673, -0.49999022483825684, -0.4999903440475464, -0.4999903440475464, -0.4999905824661255, -0.4999905824661255, -0.49999064207077026, -0.4999907314777374, -0.49999064207077026, -0.49999064207077026, -0.4999907612800598, -0.4999907910823822, -0.4999907612800598, -0.4999907910823822, -0.4999908208847046, -0.4999908208847046, -0.4999908208847046, -0.4999907612800598, -0.4999907910823822, -0.49999070167541504, -0.4999907910823822, -0.49999070167541504, -0.4999907314777374, -0.4999907612800598, -0.4999908208847046, -0.4999907910823822, -0.4999907612800598, -0.49999067187309265, -0.4999905526638031, -0.49999040365219116, -0.49999040365219116, -0.49999022483825684, -0.4999900460243225, -0.49998971819877625, -0.49998947978019714, -0.4999889135360718, -0.4999880790710449, -0.49998724460601807, -0.4999855160713196, -0.4999828338623047, -0.49997764825820923, -0.49996739625930786, -0.49994611740112305, -0.49989914894104004, -0.49979984760284424, -0.4996480941772461, -0.49956846237182617, -0.49967312812805176, -0.4998207092285156, -0.49990952014923096, -0.4999513626098633, -0.49997031688690186, -0.49997901916503906, -0.49998390674591064, -0.49998652935028076, -0.4999881386756897, -0.49998921155929565, -0.49998989701271057, -0.4999902844429016, -0.4999905228614807, -0.4999907612800598, -0.4999910593032837, -0.499991238117218, -0.49999135732650757, -0.4999915659427643, -0.4999915361404419, -0.49999165534973145, -0.49999165534973145, -0.4999917447566986, -0.49999183416366577, -0.49999168515205383, -0.49999168515205383, -0.4999918043613434, -0.49999183416366577, -0.4999917447566986, -0.49999186396598816, -0.49999189376831055, -0.49999192357063293, -0.49999189376831055, -0.49999183416366577, -0.499991774559021, -0.4999917447566986, -0.49999168515205383, -0.49999165534973145, -0.49999159574508667, -0.49999159574508667, -0.49999159574508667, -0.4999915063381195, -0.49999135732650757, -0.49999141693115234, -0.4999912679195404, -0.49999117851257324, -0.49999094009399414, -0.49999094009399414, -0.49999094009399414, -0.4999907314777374, -0.4999903738498688, -0.4999901056289673, -0.49998942017555237, -0.49998870491981506, -0.4999878406524658, -0.49998611211776733, -0.49998295307159424, -0.4999772906303406, -0.4999656677246094, -0.49994146823883057, -0.49988794326782227, -0.49977827072143555, -0.49962520599365234, -0.4995756149291992, -0.4996999502182007, -0.49984073638916016, -0.4999202489852905, -0.49995648860931396, -0.4999730587005615, -0.499981164932251, -0.49998533725738525, -0.49998778104782104, -0.49998897314071655, -0.49998974800109863, -0.49999040365219116, -0.49999088048934937, -0.49999117851257324, -0.49999144673347473, -0.49999162554740906, -0.4999918043613434, -0.49999186396598816, -0.49999189376831055, -0.49999189376831055, -0.49999189376831055, -0.4999919533729553, -0.49999183416366577, -0.4999918043613434, -0.4999918043613434, -0.49999183416366577, -0.49999183416366577, -0.49999183416366577, -0.49999189376831055, -0.49999183416366577, -0.49999189376831055, -0.49999192357063293, -0.4999919533729553, -0.49999189376831055, -0.4999920129776001, -0.4999920129776001, -0.4999920427799225, -0.4999919533729553, -0.4999919533729553, -0.4999919831752777, -0.4999919533729553, -0.49999186396598816, -0.4999917149543762, -0.4999917149543762, -0.4999915361404419, -0.4999912977218628, -0.49999111890792847, -0.49999088048934937, -0.4999907910823822, -0.4999905824661255, -0.49999040365219116, -0.49998992681503296, -0.49998939037323, -0.4999885559082031, -0.4999874234199524, -0.49998581409454346, -0.4999823570251465, -0.4999757409095764, -0.49996280670166016, -0.49993467330932617, -0.49987292289733887, -0.4997521638870239, -0.49960291385650635, -0.49958479404449463, -0.4997239112854004, -0.49985504150390625, -0.49992501735687256, -0.49995720386505127, -0.4999716877937317, -0.4999787211418152, -0.49998247623443604, -0.4999845027923584, -0.49998587369918823, -0.4999866783618927, -0.49998709559440613, -0.49998748302459717, -0.49998778104782104, -0.4999880790710449, -0.4999881684780121, -0.4999883472919464, -0.4999884366989136, -0.49998849630355835, -0.4999885559082031, -0.4999885559082031, -0.49998852610588074, -0.4999885559082031, -0.4999886453151703, -0.4999886751174927, -0.49998870491981506, -0.4999886453151703, -0.4999886155128479, -0.4999885559082031, -0.4999886751174927, -0.49998873472213745, -0.4999887943267822, -0.4999887943267822, -0.49998873472213745, -0.49998876452445984, -0.49998873472213745, -0.4999886155128479, -0.4999886751174927, -0.49998852610588074, -0.4999884366989136, -0.4999884366989136, -0.4999883770942688, -0.499988317489624, -0.49998828768730164, -0.4999881088733673, -0.49998795986175537, -0.4999879002571106, -0.4999878704547882, -0.4999876022338867, -0.49998733401298523, -0.49998706579208374, -0.4999866187572479, -0.49998602271080017, -0.4999850392341614, -0.49998390674591064, -0.49998170137405396, -0.4999780058860779, -0.49997103214263916, -0.4999566078186035, -0.4999253749847412, -0.49985623359680176, -0.49972546100616455, -0.4995845556259155, -0.4995993375778198, -0.4997473955154419, -0.4998692274093628, -0.49993109703063965, -0.4999591112136841, -0.49997180700302124, -0.4999784231185913, -0.49998176097869873, -0.49998384714126587, -0.4999850392341614, -0.499985933303833, -0.4999864995479584, -0.49998679757118225, -0.4999871850013733, -0.4999873638153076, -0.4999876022338867, -0.49998775124549866, -0.49998781085014343, -0.49998772144317627, -0.49998775124549866, -0.4999878704547882, -0.499987930059433, -0.49998795986175537, -0.499987930059433, -0.49998801946640015, -0.49998795986175537, -0.49998795986175537, -0.49998798966407776, -0.4999880790710449, -0.4999881386756897, -0.4999881386756897, -0.4999881088733673, -0.4999881386756897, -0.4999881088733673, -0.49998804926872253, -0.4999880790710449, -0.49998801946640015, -0.4999879002571106, -0.499987930059433, -0.49998795986175537, -0.49998795986175537, -0.4999878406524658, -0.49998778104782104, -0.4999876618385315, -0.4999876022338867, -0.49998754262924194, -0.49998754262924194, -0.49998730421066284, -0.4999871253967285, -0.49998676776885986, -0.499986469745636, -0.499985933303833, -0.4999854266643524, -0.4999845027923584, -0.4999830722808838, -0.49998074769973755, -0.49997663497924805, -0.49996888637542725, -0.49995267391204834, -0.49991679191589355, -0.49983811378479004, -0.4996981620788574, -0.4995725154876709, -0.4996199607849121, -0.4997727870941162, -0.49988365173339844, -0.49993836879730225, -0.4999624490737915, -0.4999735951423645, -0.49997931718826294, -0.4999825358390808, -0.4999843239784241, -0.49998530745506287, -0.4999861419200897, -0.4999866187572479, -0.49998703598976135, -0.49998727440834045, -0.49998751282691956, -0.4999876320362091, -0.49998772144317627, -0.49998778104782104, -0.4999879002571106, -0.49998804926872253, -0.4999881684780121, -0.4999881982803345, -0.4999881982803345, -0.49998825788497925, -0.49998825788497925, -0.4999883770942688, -0.49998825788497925, -0.49998825788497925, -0.499988317489624];
        const E_start = -0.5;
        const ecc = 0.6;
        const semiMajor = 1.0;

        // State
        let frame = 0;
        let playing = true;
        let speed = 5;

        // Canvas setup
        const canvas = document.getElementById('orbitCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 130;

        // Energy chart
        const eCanvas = document.getElementById('energyChart');
        const ectx = eCanvas.getContext('2d');

        // Controls
        document.getElementById('playBtn').onclick = () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? 'Pause' : 'Play';
        };
        document.getElementById('resetBtn').onclick = () => { frame = 0; };
        document.getElementById('speedSlider').oninput = (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedLabel').textContent = speed + 'x';
        };

        function drawOrbit() {
            // Clear
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars background
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 100; i++) {
                const x = (Math.sin(i * 123.456) * 0.5 + 0.5) * canvas.width;
                const y = (Math.cos(i * 654.321) * 0.5 + 0.5) * canvas.height;
                const size = Math.random() * 1.5;
                ctx.globalAlpha = 0.3 + Math.random() * 0.4;
                ctx.fillRect(x, y, size, size);
            }
            ctx.globalAlpha = 1;

            // Expected ellipse (faint reference)
            const a_px = semiMajor * scale;
            const b_px = a_px * Math.sqrt(1 - ecc * ecc);
            const c_px = ecc * a_px;
            ctx.strokeStyle = 'rgba(100, 100, 100, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(cx - c_px, cy, a_px, b_px, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // Orbit trail (gradient fade)
            const trailLength = Math.min(frame + 1, 150);
            const startIdx = Math.max(0, frame - trailLength + 1);
            ctx.lineWidth = 2;
            for (let i = startIdx; i < frame; i++) {
                const alpha = (i - startIdx) / trailLength;
                ctx.strokeStyle = `rgba(74, 170, 255, ${alpha * 0.8})`;
                ctx.beginPath();
                const x1 = cx + history[i][0] * scale;
                const y1 = cy - history[i][1] * scale;
                const x2 = cx + history[i + 1][0] * scale;
                const y2 = cy - history[i + 1][1] * scale;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }

            // Sun with glow
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, 40);
            gradient.addColorStop(0, 'rgba(255, 255, 100, 1)');
            gradient.addColorStop(0.3, 'rgba(255, 200, 50, 0.8)');
            gradient.addColorStop(0.6, 'rgba(255, 150, 0, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffee00';
            ctx.beginPath();
            ctx.arc(cx, cy, 12, 0, 2 * Math.PI);
            ctx.fill();

            // Planet
            const pos = history[frame];
            const px = cx + pos[0] * scale;
            const py = cy - pos[1] * scale;

            // Planet glow
            const pGrad = ctx.createRadialGradient(px, py, 0, px, py, 20);
            pGrad.addColorStop(0, 'rgba(74, 170, 255, 0.8)');
            pGrad.addColorStop(0.5, 'rgba(74, 170, 255, 0.2)');
            pGrad.addColorStop(1, 'rgba(74, 170, 255, 0)');
            ctx.fillStyle = pGrad;
            ctx.beginPath();
            ctx.arc(px, py, 20, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#4af';
            ctx.beginPath();
            ctx.arc(px, py, 8, 0, 2 * Math.PI);
            ctx.fill();

            // Velocity indicator
            if (frame < history.length - 1) {
                const nextPos = history[Math.min(frame + 5, history.length - 1)];
                const vx = (nextPos[0] - pos[0]) * 15;
                const vy = (nextPos[1] - pos[1]) * 15;
                ctx.strokeStyle = '#4f4';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(px, py);
                ctx.lineTo(px + vx * scale, py - vy * scale);
                ctx.stroke();
                // Arrow head
                const angle = Math.atan2(-vy, vx);
                ctx.beginPath();
                ctx.moveTo(px + vx * scale, py - vy * scale);
                ctx.lineTo(px + vx * scale - 8 * Math.cos(angle - 0.4), py - vy * scale + 8 * Math.sin(angle - 0.4));
                ctx.moveTo(px + vx * scale, py - vy * scale);
                ctx.lineTo(px + vx * scale - 8 * Math.cos(angle + 0.4), py - vy * scale + 8 * Math.sin(angle + 0.4));
                ctx.stroke();
            }

            // Distance line to sun
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(px, py);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.fillText('Sun', cx + 15, cy - 15);
            ctx.fillStyle = '#4af';
            ctx.fillText('Planet', px + 12, py - 12);
        }

        function drawEnergyChart() {
            ectx.fillStyle = '#000';
            ectx.fillRect(0, 0, eCanvas.width, eCanvas.height);

            const visibleEnergy = energyHistory.slice(0, frame + 1);
            if (visibleEnergy.length < 2) return;

            const eMin = Math.min(...energyHistory);
            const eMax = Math.max(...energyHistory);
            const range = (eMax - eMin) || 1e-10;

            // Reference line (initial energy)
            const yRef = 50 - ((E_start - eMin) / range) * 40;
            ectx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ectx.beginPath();
            ectx.moveTo(0, yRef);
            ectx.lineTo(eCanvas.width, yRef);
            ectx.stroke();

            // Energy line
            ectx.strokeStyle = '#4f4';
            ectx.lineWidth = 1.5;
            ectx.beginPath();
            for (let i = 0; i < visibleEnergy.length; i++) {
                const x = (i / energyHistory.length) * eCanvas.width;
                const y = 50 - ((visibleEnergy[i] - eMin) / range) * 40;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();
        }

        function updateStats() {
            const pos = history[frame];
            const dist = Math.sqrt(pos[0] * pos[0] + pos[1] * pos[1]);

            // Calculate velocity
            let speed_val = 0;
            if (frame < history.length - 1) {
                const next = history[frame + 1];
                const dx = next[0] - pos[0];
                const dy = next[1] - pos[1];
                speed_val = Math.sqrt(dx * dx + dy * dy) * 100; // Scale for display
            }

            const energy = energyHistory[frame];
            const drift = Math.abs(energy - E_start) / Math.abs(E_start);

            document.getElementById('posValue').textContent = `(${pos[0].toFixed(2)}, ${pos[1].toFixed(2)})`;
            document.getElementById('distValue').textContent = dist.toFixed(3);
            document.getElementById('speedValue').textContent = speed_val.toFixed(3);
            document.getElementById('orbitValue').textContent = `${(frame / history.length * 100).toFixed(1)}%`;
            document.getElementById('energyValue').textContent = energy.toFixed(6);
            document.getElementById('driftValue').textContent = drift.toExponential(2);

            // Color code drift
            const driftEl = document.getElementById('driftValue');
            if (drift < 1e-6) {
                driftEl.className = 'stat-value good';
            } else if (drift < 1e-3) {
                driftEl.className = 'stat-value warn';
            } else {
                driftEl.className = 'stat-value';
                driftEl.style.color = '#f44';
            }
        }

        function animate() {
            drawOrbit();
            drawEnergyChart();
            updateStats();

            if (playing) {
                frame = (frame + speed) % history.length;
            }

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
    