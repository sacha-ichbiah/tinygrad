<!DOCTYPE html>
<html>
<head>
    <title>Point Vortex Dynamics - TinyPhysics</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0a1a;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        canvas { border: 1px solid #333; background: #000; }
        .info {
            background: #111;
            padding: 15px;
            border-radius: 5px;
            max-width: 500px;
        }
        .info h3 { margin-top: 0; color: #4af; }
        code { color: #4f4; }
        .controls { margin: 10px; }
        button { padding: 8px 16px; margin: 0 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Point Vortex Dynamics - Kirchhoff's Equations</h1>
    <div class="info">
        <h3>The TinyPhysics Way</h3>
        <p>Define ONLY the Hamiltonian:</p>
        <code>H = -1/(4π) Σ Γ_i Γ_j log|r_ij|</code>
        <p>Kirchhoff's equations derived automatically via autograd!</p>
        <p><span style="color:#ff4444">●</span> Positive circulation &nbsp;
           <span style="color:#4444ff">●</span> Negative circulation</p>
    </div>
    <div class="controls">
        <button onclick="togglePlay()">Play/Pause</button>
        <button onclick="reset()">Reset</button>
        <span id="frameInfo">Frame: 0</span>
    </div>
    <div class="container">
        <canvas id="vortexCanvas" width="600" height="600"></canvas>
        <canvas id="energyCanvas" width="300" height="200"></canvas>
    </div>
    <script>
        const trajectories = [[[1.0, 0.0], [-0.5, 0.8660253882408142], [-0.5, -0.8660253882408142]], [[0.9999683499336243, 0.007957663387060165], [-0.5068756937980652, 0.8620191216468811], [-0.4930926263332367, -0.869976818561554]], [[0.9998733401298523, 0.01591482385993004], [-0.5137193202972412, 0.8579582571983337], [-0.48615404963493347, -0.8738731145858765]], [[0.9997150301933289, 0.023870976641774178], [-0.5205304026603699, 0.853843092918396], [-0.47918465733528137, -0.8777140974998474]], [[0.999493420124054, 0.03182561695575714], [-0.5273085236549377, 0.849673867225647], [-0.4721849262714386, -0.8814994692802429]], [[0.9992085099220276, 0.03977824002504349], [-0.5340532064437866, 0.8454508185386658], [-0.46515530347824097, -0.8852290511131287]], [[0.9988603591918945, 0.047728344798088074], [-0.5407641530036926, 0.8411741852760315], [-0.4580962359905243, -0.8889026045799255]], [[0.99844890832901, 0.05567542836070061], [-0.5474408268928528, 0.8368443250656128], [-0.451008141040802, -0.8925198316574097]], [[0.9979742765426636, 0.0636189877986908], [-0.5540828108787537, 0.8324614763259888], [-0.4438914954662323, -0.8960805535316467]], [[0.9974364638328552, 0.07155852019786835], [-0.5606897473335266, 0.8280259370803833], [-0.436746746301651, -0.8995845317840576]], [[0.996835470199585, 0.07949351519346237], [-0.5672611594200134, 0.8235379457473755], [-0.4295743405818939, -0.9030315279960632]], [[0.9961712956428528, 0.08742347359657288], [-0.5737966299057007, 0.8189978003501892], [-0.4223747253417969, -0.9064213633537292]], [[0.9954440593719482, 0.09534789621829987], [-0.580295741558075, 0.8144057989120483], [-0.4151483476161957, -0.9097537994384766]], [[0.9946538209915161, 0.10326629132032394], [-0.5867581367492676, 0.8097622394561768], [-0.40789568424224854, -0.9130285978317261]], [[0.9938005208969116, 0.11117813736200333], [-0.5931833386421204, 0.8050673604011536], [-0.40061721205711365, -0.9162456393241882]], [[0.9928843379020691, 0.11908294260501862], [-0.5995709896087646, 0.8003215193748474], [-0.39331334829330444, -0.9194045662879944]], [[0.9919052720069885, 0.12698020040988922], [-0.605920672416687, 0.7955250144004822], [-0.3859845697879791, -0.9225053191184998]], [[0.9908633828163147, 0.13486942648887634], [-0.612231969833374, 0.7906781435012817], [-0.3786313533782959, -0.9255476593971252]], [[0.9897587299346924, 0.1427501142024994], [-0.618504524230957, 0.78578120470047], [-0.37125417590141296, -0.9285313487052917]], [[0.9885914325714111, 0.15062177181243896], [-0.6247379183769226, 0.7808344960212708], [-0.36385348439216614, -0.9314562082290649]], [[0.9873615503311157, 0.15848389267921448], [-0.6309317350387573, 0.775838315486908], [-0.3564297556877136, -0.9343221187591553]], [[0.9860690832138062, 0.16633597016334534], [-0.6370856165885925, 0.7707930207252502], [-0.34898343682289124, -0.9371289014816284]], [[0.9847142100334167, 0.17417751252651215], [-0.6431991457939148, 0.7656988501548767], [-0.34151503443717957, -0.9398763179779053]], [[0.9832969903945923, 0.1820080280303955], [-0.6492719650268555, 0.7605562210083008], [-0.33402499556541443, -0.9425642490386963]], [[0.9818175435066223, 0.18982701003551483], [-0.6553036570549011, 0.7553654313087463], [-0.3265138268470764, -0.9451924562454224]], [[0.9802758693695068, 0.19763396680355072], [-0.6612938642501831, 0.7501267790794373], [-0.31898197531700134, -0.947760820388794]], [[0.9786721467971802, 0.20542840659618378], [-0.667242169380188, 0.744840681552887], [-0.3114299178123474, -0.9502691626548767]], [[0.9770064353942871, 0.2132098525762558], [-0.6731482744216919, 0.7395074367523193], [-0.3038581311702728, -0.9527173042297363]], [[0.9752788543701172, 0.220977783203125], [-0.6790117025375366, 0.7341273427009583], [-0.2962670922279358, -0.9551051259040833]], [[0.9734894633293152, 0.22873173654079437], [-0.6848321557044983, 0.7287007570266724], [-0.2886573076248169, -0.9574324488639832]], [[0.9716385006904602, 0.23647120594978333], [-0.6906092166900635, 0.7232280373573303], [-0.28102925419807434, -0.9596991539001465]], [[0.969726026058197, 0.24419568479061127], [-0.6963425874710083, 0.717709481716156], [-0.27338337898254395, -0.9619050621986389]], [[0.9677520990371704, 0.2519047260284424], [-0.7020318508148193, 0.7121455073356628], [-0.2657202184200287, -0.9640501141548157]], [[0.9657168984413147, 0.2595977783203125], [-0.7076766490936279, 0.7065364122390747], [-0.2580402195453644, -0.9661341309547424]], [[0.9636205434799194, 0.2672743797302246], [-0.7132766246795654, 0.700882613658905], [-0.25034385919570923, -0.9681569337844849]], [[0.9614631533622742, 0.2749341130256653], [-0.7188314199447632, 0.6951844096183777], [-0.2426316738128662, -0.9701184630393982]], [[0.9592448472976685, 0.28257638216018677], [-0.7243406772613525, 0.6894422173500061], [-0.23490411043167114, -0.9720185399055481]], [[0.9569658041000366, 0.29020076990127563], [-0.7298040986061096, 0.6836563348770142], [-0.22716167569160461, -0.973857045173645]], [[0.954626202583313, 0.2978067994117737], [-0.735221266746521, 0.6778271794319153], [-0.21940486133098602, -0.9756339192390442]], [[0.9522261023521423, 0.3053939640522003], [-0.7405918836593628, 0.6719551086425781], [-0.21163415908813477, -0.9773489832878113]], [[0.9497657418251038, 0.31296178698539734], [-0.7459155917167664, 0.6660404205322266], [-0.20385004580020905, -0.9790021777153015]], [[0.947245180606842, 0.32050979137420654], [-0.7511920928955078, 0.6600835919380188], [-0.19605302810668945, -0.9805933833122253]], [[0.944664716720581, 0.3280375003814697], [-0.7564210295677185, 0.6540849804878235], [-0.18824359774589539, -0.9821224212646484]], [[0.9420244097709656, 0.3355444371700287], [-0.7616020441055298, 0.6480449438095093], [-0.18042224645614624, -0.9835893511772156]], [[0.9393244385719299, 0.3430301249027252], [-0.7667348980903625, 0.6419638395309448], [-0.1725894659757614, -0.9849939346313477]], [[0.9365649819374084, 0.3504940867424011], [-0.7718191742897034, 0.6358420848846436], [-0.1647457480430603, -0.9863361120223999]], [[0.9337462186813354, 0.3579358458518982], [-0.7768545746803284, 0.6296800374984741], [-0.1568915992975235, -0.9876158237457275]], [[0.9308683276176453, 0.3653549551963806], [-0.7818408012390137, 0.6234781742095947], [-0.1490275114774704, -0.9888330698013306]], [[0.9279314875602722, 0.3727509379386902], [-0.7867774963378906, 0.6172367930412292], [-0.1411539912223816, -0.9899876713752747]], [[0.9249358773231506, 0.3801233172416687], [-0.7916643619537354, 0.6109563112258911], [-0.13327154517173767, -0.991079568862915]], [[0.9218816757202148, 0.38747161626815796], [-0.796501100063324, 0.6046371459960938], [-0.12538065016269684, -0.9921087026596069]]];
        const energies = [-0.1311371624469757, -0.1311371624469757, -0.13113714754581451, -0.13113714754581451, -0.13113714754581451, -0.1311371624469757, -0.1311371624469757, -0.1311371624469757, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371624469757, -0.1311371773481369, -0.1311371773481369, -0.1311371624469757, -0.1311371624469757, -0.13113714754581451, -0.13113714754581451, -0.1311371624469757, -0.1311371624469757, -0.13113714754581451, -0.1311371773481369, -0.13113714754581451, -0.13113714754581451, -0.13113714754581451, -0.13113714754581451, -0.1311371624469757, -0.1311371624469757, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371624469757, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369, -0.1311371773481369];
        const colors = ["#ff4444", "#ff4444", "#ff4444"];
        const nVortices = 3;

        const canvas = document.getElementById('vortexCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 150;

        const eCanvas = document.getElementById('energyCanvas');
        const ectx = eCanvas.getContext('2d');

        let frame = 0;
        let playing = true;
        let trailLength = 50;

        function drawFrame() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw trails
            const trailStart = Math.max(0, frame - trailLength);
            for (let v = 0; v < nVortices; v++) {
                ctx.strokeStyle = colors[v];
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.6;
                ctx.beginPath();
                for (let t = trailStart; t <= frame; t++) {
                    const x = cx + trajectories[t][v][0] * scale;
                    const y = cy - trajectories[t][v][1] * scale;
                    if (t === trailStart) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Draw current positions
            ctx.globalAlpha = 1.0;
            const current = trajectories[frame];
            for (let v = 0; v < nVortices; v++) {
                const x = cx + current[v][0] * scale;
                const y = cy - current[v][1] * scale;
                ctx.fillStyle = colors[v];
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Draw energy plot
            ectx.fillStyle = '#000';
            ectx.fillRect(0, 0, eCanvas.width, eCanvas.height);
            ectx.fillStyle = '#fff';
            ectx.font = '12px monospace';
            ectx.fillText('Energy Conservation', 10, 20);

            const eMin = Math.min(...energies);
            const eMax = Math.max(...energies);
            const range = eMax - eMin || 1e-10;

            ectx.strokeStyle = '#333';
            ectx.beginPath();
            for (let i = 0; i < energies.length; i++) {
                const x = 10 + (i / energies.length) * 280;
                const y = 180 - ((energies[i] - eMin) / range) * 150;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();

            // Highlight current position on energy plot
            ectx.strokeStyle = '#4f4';
            ectx.lineWidth = 2;
            ectx.beginPath();
            for (let i = 0; i <= frame; i++) {
                const x = 10 + (i / energies.length) * 280;
                const y = 180 - ((energies[i] - eMin) / range) * 150;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();

            const drift = Math.abs(energies[frame] - energies[0]) / (Math.abs(energies[0]) || 1e-10);
            ectx.fillText('Drift: ' + drift.toExponential(2), 10, 195);

            document.getElementById('frameInfo').textContent = 'Frame: ' + frame + '/' + (trajectories.length - 1);
        }

        function animate() {
            if (playing) {
                frame = (frame + 1) % trajectories.length;
            }
            drawFrame();
            requestAnimationFrame(animate);
        }

        function togglePlay() {
            playing = !playing;
        }

        function reset() {
            frame = 0;
        }

        animate();
    </script>
</body>
</html>