<!DOCTYPE html>
<html>
<head>
    <title>Point Vortex Dynamics - TinyPhysics</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0a1a;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        canvas { border: 1px solid #333; background: #000; }
        .info {
            background: #111;
            padding: 15px;
            border-radius: 5px;
            max-width: 500px;
        }
        .info h3 { margin-top: 0; color: #4af; }
        code { color: #4f4; }
        .controls { margin: 10px; }
        button { padding: 8px 16px; margin: 0 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Point Vortex Dynamics - Kirchhoff's Equations</h1>
    <div class="info">
        <h3>The TinyPhysics Way</h3>
        <p>Define ONLY the Hamiltonian:</p>
        <code>H = -1/(4π) Σ Γ_i Γ_j log|r_ij|</code>
        <p>Kirchhoff's equations derived automatically via autograd!</p>
        <p><span style="color:#ff4444">●</span> Positive circulation &nbsp;
           <span style="color:#4444ff">●</span> Negative circulation</p>
    </div>
    <div class="controls">
        <button onclick="togglePlay()">Play/Pause</button>
        <button onclick="reset()">Reset</button>
        <span id="frameInfo">Frame: 0</span>
    </div>
    <div class="container">
        <canvas id="vortexCanvas" width="600" height="600"></canvas>
        <canvas id="energyCanvas" width="300" height="200"></canvas>
    </div>
    <script>
        const trajectories = [[[-0.5, 0.0], [0.5, 0.0]], [[-0.49996834993362427, -0.007957495748996735], [0.49996834993362427, 0.007957495748996735]], [[-0.4998100697994232, -0.015912976115942], [0.4998100697994232, 0.015912976115942]], [[-0.499525249004364, -0.023864425718784332], [0.499525249004364, 0.023864425718784332]], [[-0.4991139769554138, -0.031809836626052856], [0.4991139769554138, 0.031809836626052856]], [[-0.49857643246650696, -0.039747197180986404], [0.49857643246650696, 0.039747197180986404]], [[-0.497912734746933, -0.047674503177404404], [0.497912734746933, 0.047674503177404404]], [[-0.4971230924129486, -0.05558975040912628], [0.4971230924129486, 0.05558975040912628]], [[-0.49620774388313293, -0.06349094212055206], [0.49620774388313293, 0.06349094212055206]], [[-0.49516695737838745, -0.07137608528137207], [0.49516695737838745, 0.07137608528137207]], [[-0.49400103092193604, -0.07924318313598633], [0.49400103092193604, 0.07924318313598633]], [[-0.49271026253700256, -0.08709026128053665], [0.49271026253700256, 0.08709026128053665]], [[-0.4912950396537781, -0.09491533786058426], [0.4912950396537781, 0.09491533786058426]], [[-0.4897557199001312, -0.10271644592285156], [0.4897557199001312, 0.10271644592285156]], [[-0.4880927503108978, -0.11049161106348038], [0.4880927503108978, 0.11049161106348038]], [[-0.4863065779209137, -0.1182388961315155], [0.4863065779209137, 0.1182388961315155]], [[-0.4843977093696594, -0.12595634162425995], [0.4843977093696594, 0.12595634162425995]], [[-0.4823665916919708, -0.13364200294017792], [0.4823665916919708, 0.13364200294017792]], [[-0.48021385073661804, -0.1412939578294754], [0.48021385073661804, 0.1412939578294754]], [[-0.47793999314308167, -0.1489102840423584], [0.47793999314308167, 0.1489102840423584]], [[-0.4755456745624542, -0.1564890742301941], [0.4755456745624542, 0.1564890742301941]], [[-0.4730314612388611, -0.16402842104434967], [0.4730314612388611, 0.16402842104434967]], [[-0.47039809823036194, -0.17152643203735352], [0.47039809823036194, 0.17152643203735352]], [[-0.46764621138572693, -0.1789812296628952], [0.46764621138572693, 0.1789812296628952]], [[-0.46477654576301575, -0.1863909512758255], [0.46477654576301575, 0.1863909512758255]], [[-0.4617898464202881, -0.19375374913215637], [0.4617898464202881, 0.19375374913215637]], [[-0.4586869180202484, -0.20106777548789978], [0.4586869180202484, 0.20106777548789978]], [[-0.4554685354232788, -0.20833119750022888], [0.4554685354232788, 0.20833119750022888]], [[-0.4521355628967285, -0.21554221212863922], [0.4521355628967285, 0.21554221212863922]], [[-0.4486888647079468, -0.22269901633262634], [0.4486888647079468, 0.22269901633262634]], [[-0.4451293647289276, -0.2297998070716858], [0.4451293647289276, 0.2297998070716858]], [[-0.44145792722702026, -0.23684284090995789], [0.44145792722702026, 0.23684284090995789]], [[-0.4376755654811859, -0.24382634460926056], [0.4376755654811859, 0.24382634460926056]], [[-0.4337832033634186, -0.25074857473373413], [0.4337832033634186, 0.25074857473373413]], [[-0.42978188395500183, -0.2576078176498413], [0.42978188395500183, 0.2576078176498413]], [[-0.42567259073257446, -0.2644023597240448], [0.42567259073257446, 0.2644023597240448]], [[-0.4214564561843872, -0.2711305320262909], [0.4214564561843872, 0.2711305320262909]], [[-0.41713449358940125, -0.2777906358242035], [0.41713449358940125, 0.2777906358242035]], [[-0.4127078652381897, -0.2843810021877289], [0.4127078652381897, 0.2843810021877289]], [[-0.4081776738166809, -0.29090002179145813], [0.4081776738166809, 0.29090002179145813]], [[-0.403545081615448, -0.2973460555076599], [0.403545081615448, 0.2973460555076599]], [[-0.39881134033203125, -0.30371755361557007], [0.39881134033203125, 0.30371755361557007]], [[-0.3939775824546814, -0.31001290678977966], [0.3939775824546814, 0.31001290678977966]], [[-0.3890450894832611, -0.31623053550720215], [0.3890450894832611, 0.31623053550720215]], [[-0.38401511311531067, -0.32236894965171814], [0.38401511311531067, 0.32236894965171814]], [[-0.37888893485069275, -0.3284265697002411], [0.37888893485069275, 0.3284265697002411]], [[-0.37366783618927, -0.334401935338974], [0.37366783618927, 0.334401935338974]], [[-0.3683531582355499, -0.3402935862541199], [0.3683531582355499, 0.3402935862541199]], [[-0.3629463016986847, -0.3461000323295593], [0.3629463016986847, 0.3461000323295593]], [[-0.35744860768318176, -0.35181987285614014], [0.35744860768318176, 0.35181987285614014]], [[-0.35186147689819336, -0.3574516773223877], [0.35186147689819336, 0.3574516773223877]]];
        const energies = [-0.0, -5.041687927587191e-06, -1.0077996194013394e-05, -1.5113664630916901e-05, -2.014869824051857e-05, -2.518783549021464e-05, -3.0216851882869378e-05, -3.524997373460792e-05, -4.028246257803403e-05, -4.531430749921128e-05, -5.0340786401648074e-05, -5.536662501981482e-05, -6.039183062966913e-05, -6.541166658280417e-05, -7.043086952762678e-05, -7.545416883658618e-05, -8.04720984888263e-05, -8.548940240871161e-05, -9.051081724464893e-05, -9.552211122354493e-05, -0.00010054224549094215, -0.00010555229528108612, -0.0001105711780837737, -0.00011557994002941996, -0.00012058809079462662, -0.00012559561582747847, -0.00013060250785201788, -0.00013560404477175325, -0.00014060494140721858, -0.0001456052268622443, -0.00015060961595736444, -0.00015560859174001962, -0.00016061171481851488, -0.00016560949734412134, -0.00017060662503354251, -0.00017559838306624442, -0.00018059898866340518, -0.0001855895243352279, -0.00019058417819906026, -0.0001955734333023429, -0.00020055736240465194, -0.0002055453951470554, -0.0002105327876051888, -0.00021552431280724704, -0.00022051043924875557, -0.00022549123968929052, -0.00023047142894938588, -0.00023545102158095688, -0.00024043464509304613, -0.0002454129862599075, -0.00025039067259058356];
        const colors = ["#ff4444", "#ff4444"];
        const nVortices = 2;

        const canvas = document.getElementById('vortexCanvas');
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const scale = 150;

        const eCanvas = document.getElementById('energyCanvas');
        const ectx = eCanvas.getContext('2d');

        let frame = 0;
        let playing = true;
        let trailLength = 50;

        function drawFrame() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw trails
            const trailStart = Math.max(0, frame - trailLength);
            for (let v = 0; v < nVortices; v++) {
                ctx.strokeStyle = colors[v];
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.6;
                ctx.beginPath();
                for (let t = trailStart; t <= frame; t++) {
                    const x = cx + trajectories[t][v][0] * scale;
                    const y = cy - trajectories[t][v][1] * scale;
                    if (t === trailStart) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Draw current positions
            ctx.globalAlpha = 1.0;
            const current = trajectories[frame];
            for (let v = 0; v < nVortices; v++) {
                const x = cx + current[v][0] * scale;
                const y = cy - current[v][1] * scale;
                ctx.fillStyle = colors[v];
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Draw energy plot
            ectx.fillStyle = '#000';
            ectx.fillRect(0, 0, eCanvas.width, eCanvas.height);
            ectx.fillStyle = '#fff';
            ectx.font = '12px monospace';
            ectx.fillText('Energy Conservation', 10, 20);

            const eMin = Math.min(...energies);
            const eMax = Math.max(...energies);
            const range = eMax - eMin || 1e-10;

            ectx.strokeStyle = '#333';
            ectx.beginPath();
            for (let i = 0; i < energies.length; i++) {
                const x = 10 + (i / energies.length) * 280;
                const y = 180 - ((energies[i] - eMin) / range) * 150;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();

            // Highlight current position on energy plot
            ectx.strokeStyle = '#4f4';
            ectx.lineWidth = 2;
            ectx.beginPath();
            for (let i = 0; i <= frame; i++) {
                const x = 10 + (i / energies.length) * 280;
                const y = 180 - ((energies[i] - eMin) / range) * 150;
                if (i === 0) ectx.moveTo(x, y);
                else ectx.lineTo(x, y);
            }
            ectx.stroke();

            const drift = Math.abs(energies[frame] - energies[0]) / (Math.abs(energies[0]) || 1e-10);
            ectx.fillText('Drift: ' + drift.toExponential(2), 10, 195);

            document.getElementById('frameInfo').textContent = 'Frame: ' + frame + '/' + (trajectories.length - 1);
        }

        function animate() {
            if (playing) {
                frame = (frame + 1) % trajectories.length;
            }
            drawFrame();
            requestAnimationFrame(animate);
        }

        function togglePlay() {
            playing = !playing;
        }

        function reset() {
            frame = 0;
        }

        animate();
    </script>
</body>
</html>